<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/FiraCode-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | Securityfest CTF - Defacer Challenge Writeup"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | Securityfest CTF - Defacer Challenge Writeup"><meta name=twitter:title content="dubell.io | Securityfest CTF - Defacer Challenge Writeup"><meta itemprop=name content="dubell.io | Securityfest CTF - Defacer Challenge Writeup"><meta name=application-name content="dubell.io | Securityfest CTF - Defacer Challenge Writeup"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content="2016-06-08T00:00:00Z"><meta property="article:published_time" content="2016-06-08T00:00:00Z"><base href=https://dubell.io/securityfest-ctf-defacer-challenge-writeup/><link rel=canonical href=https://dubell.io/securityfest-ctf-defacer-challenge-writeup/ itemprop=url><meta name=url content="https://dubell.io/securityfest-ctf-defacer-challenge-writeup/"><meta name=twitter:url content="https://dubell.io/securityfest-ctf-defacer-challenge-writeup/"><meta property="og:url" content="https://dubell.io/securityfest-ctf-defacer-challenge-writeup/"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta itemprop=image content="https://dubell.io/img/logo2.png"><meta property="og:image" content="https://dubell.io/img/logo2.png"><meta name=twitter:image content="https://dubell.io/img/logo2.png"><meta name=twitter:image:src content="https://dubell.io/img/logo2.png"><meta property="og:updated_time" content="2016-06-08T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.iositemap.xml><title>dubell.io | Securityfest CTF - Defacer Challenge Writeup</title></head><body><div class=container><div id=particles-js></div><div class=row><div class=col><header style=text-align:center><a href=/ class=noleet><img href=/ class=banner-image src=/img/logo2.png alt=logo></a></header></div></div><div class=row><div class=col style=text-align:center><nav><fieldset><legend>n4vig4ti0n</legend><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></fieldset></nav></div></div><div class=row><div class=content><article><div class=row><div class=col><h1>Securityfest CTF - Defacer Challenge Writeup</h1><p class=small style=color:#999><a href=/categories/ctf>CTF</a> / June 8, 2016 â€¢ 2 min read</p></div></div><div class=row><div class=col><div id=article-content><p>I actually learned something entirely new on this challenge, I decided I had to do a writeup to share my findings.</p><p>If you read my <a href=https://dubell.io/securityfest-ctf-coresec-challenge-writeup/>previous Securityfest CTF writeup</a> you perhaps know that these challenges were from <a href=https://securityfest.com/>securityfest</a> held in Sweden, which I attended. I did not solve this particular challenge on time in order to win any prizes, but that didn&rsquo;t stop me from trying to solve it.</p><p>The challenge is to get the flag by defacing this website <a href=http://alienzon.com/>http://alienzon.com/</a> which is protected by <em>(simple)</em> <a href=https://www.owasp.org/index.php/Web_Application_Firewall>WAF</a>. I actually spent 4-5 hours on this challenge testing different attack vectors that did not work. I tried SQL injections and XSS attacks all over the place but no joy. So I turned to the place where I thought would be the correct path because it most the most odd part of the website. It was on the <em>Fun Stuff</em> page under <strong>Be a hero in a star story!</strong> section. The odd thing about this part is that when you enter your name and click submit, the post request looks like this:</p><pre tabindex=0><code>who=/Han+Solo/&amp;yourname=Hacker
</code></pre><p>Why are there forward slashes in the request?</p><p>After playing with the <code>who</code> parameter for quite some time I realized that if I change the parameter to:</p><pre tabindex=0><code>who=/Han/&amp;yourname=Hacker
</code></pre><p>The story on the next page would say <em>Hacker Solo</em>. It didn&rsquo;t click before but now I knew the backend code was most likely using <a href=http://php.net/manual/en/function.preg-replace.php>preg_replace()</a> to replace the strings. This information at first didn&rsquo;t help me very much, I continued to change the parameter thinking I could perhaps trigger a XSS but nope.</p><p>After a while I gave up and just googled <em>preg_replace exploits</em>, first website to show up was <a href=http://www.madirish.net/402>http://www.madirish.net/402</a>. According to that website, if the <code>e</code> modifier is used with the regular expression, an attacker may have the possibility to execute PHP code. Armed with this new information I crafted this fine request:</p><pre tabindex=0><code>who=/(Han)/e&amp;yourname=strtoupper($1)
</code></pre><p>I put <strong>Han</strong> in parentheses because that creates a group which you can match with the $1. The <code>strtoupper()</code> function simply converts a supplied string to uppercase. I sent the request away and checked the output, <em>Han</em> was now <em>HAN</em>, it goddamn worked. I now have a <a href=https://en.wikipedia.org/wiki/Arbitrary_code_execution>RCE</a>.</p><p>I sent the following request to identify the user running the web server:</p><pre tabindex=0><code>who=/(Han)/e&amp;yourname=`id`
</code></pre><p>At first I tried double quotes but that didn&rsquo;t work, then I tried single quotes but that got blocked by the WAF. So I tried the <em>grave accent</em> character ` and voila, it worked. The user running the web server was <code>www-data</code>.</p><p>Next was to list all the files in the directory:</p><pre tabindex=0><code>who=/(Han)/e&amp;yourname=`ls -lah`
</code></pre><p>Then view the config.php file:</p><pre tabindex=0><code>who=/(Han)/e&amp;yourname=`cat config.php`
</code></pre><p>Which gave me the following:</p><pre tabindex=0><code>// Set the admin info here!
$admin_username = &#39;admin&#39;;
$admin_password = &#39;deepspace&#39;;
[...]
</code></pre><p>Now I simply login with the above credentials and get the flag:</p><pre tabindex=0><code>CODE{R3gular_Expr3ssions_Now_You_Have_2_Probl3ms}
</code></pre></div></div></div></article></div></div><footer></footer></div><script src=/js/particles.min.js defer></script><script src=/js/particles.conf.js defer></script><script src=/js/baffle.min.js async></script><script src=/js/main.js defer async></script></body></html>