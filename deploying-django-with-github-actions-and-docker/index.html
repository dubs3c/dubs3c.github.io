<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/vollkorn/Vollkorn-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | Deploying Django with Github Actions and Docker"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | Deploying Django with Github Actions and Docker"><meta name=twitter:title content="dubell.io | Deploying Django with Github Actions and Docker"><meta itemprop=name content="dubell.io | Deploying Django with Github Actions and Docker"><meta name=application-name content="dubell.io | Deploying Django with Github Actions and Docker"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content=2023-09-02T14:51:17+0200><meta property="article:published_time" content=2023-09-02T14:51:17+0200><base href=https://dubell.io/deploying-django-with-github-actions-and-docker/><link rel=canonical href=https://dubell.io/deploying-django-with-github-actions-and-docker/ itemprop=url><meta name=url content="https://dubell.io/deploying-django-with-github-actions-and-docker/"><meta name=twitter:url content="https://dubell.io/deploying-django-with-github-actions-and-docker/"><meta property="og:url" content="https://dubell.io/deploying-django-with-github-actions-and-docker/"><meta property="og:article:author" content="Dubs3c"><meta property="article:author" content="Dubs3c"><meta name=author content="Dubs3c"><meta name=description content="Deploying Django with Github Actions and Docker"><meta itemprop=description content="Deploying Django with Github Actions and Docker"><meta property="og:description" content="Deploying Django with Github Actions and Docker"><meta name=twitter:description content="Deploying Django with Github Actions and Docker"><meta itemprop=image content="https://dubell.io/img/logo2.png"><meta property="og:image" content="https://dubell.io/img/logo2.png"><meta name=twitter:image content="https://dubell.io/img/logo2.png"><meta name=twitter:image:src content="https://dubell.io/img/logo2.png"><meta property="og:updated_time" content=2023-09-02T14:51:17+0200><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.io/sitemap.xml><title>dubell.io | Deploying Django with Github Actions and Docker</title></head><body><div class=container><div class=row><div class=col><h1 class=logo-title><a href=/>dubell.io</a></h1></div></div><div class=row><div class=col><nav id=menu><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></nav></div></div><div class=row><article><h1>Deploying Django with Github Actions and Docker</h1><p><small><a href=/categories/development>Development</a> / September 2, 2023 â€¢ 4 min read</small><br><small><strong>Tags:</strong> <a href=/tags/django class=tag>Django</a></small></p><div id=article_content><div class=row><div class=col-lg-6><p>In this article, you will learn how to deploy your Django application to your VPS using Github Actions.</p><p>If you want to, you can checkout one of my Django applications here, where I have implemented the steps described in this article.
The main idea is that every time you create a &ldquo;release&rdquo;, Github will pick up newest release version and trigger a docker build for that release. The end result is quite amazing, because now you can simply run <code>docker pull ghcr.io/&lt;user>/repo:latest</code> on your VPS to get the latest version.
The article assumes a moderate level of understanding of docker.</p><h3 id=the-setup>The Setup</h3><p>Before we begin working with Github actions, make sure you have the correct configuration setup. Personally, I create an env folder in my project settings folder, as can be seen here. This folder can contain your production, developer and staging setup. In my my setup, I created a prod.py config file for running in production. Database credentials and so on are fetched via environment variables in my <code>docker-compose.yml</code> file. Make sure you set <code>DEBUG=False</code> when running in production mode.</p><h3 id=dockerfile>Dockerfile</h3><p>My Dockerfile is structured as followed:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#1c01ce>FROM python:3.10-slim-bullseye</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#1c01ce>ENV PYTHONUNBUFFERED 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#1c01ce>RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install -y \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#1c01ce>git \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  <span style=color:#1c01ce>gcc \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#1c01ce>musl-dev \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>  <span style=color:#1c01ce>libffi-dev \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  <span style=color:#1c01ce>make \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  <span style=color:#1c01ce>libxslt-dev \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  <span style=color:#1c01ce>dos2unix \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>  <span style=color:#1c01ce>unzip \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  <span style=color:#1c01ce>procps \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  <span style=color:#633820>&amp;&amp;</span> <span style=color:#1c01ce>groupadd -r -g 997 burgarkartan \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  <span style=color:#633820>&amp;&amp;</span> <span style=color:#1c01ce>useradd -m -s /usr/sbin/nologin -u 998 -g burgarkartan burgarkartan \</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>  <span style=color:#633820>&amp;&amp;</span> <span style=color:#1c01ce>pip install --upgrade pip</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#1c01ce>USER burgarkartan</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#1c01ce>RUN mkdir -p /home/burgarkartan/project</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#1c01ce>WORKDIR /home/burgarkartan/project</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#1c01ce>COPY --chown=burgarkartan . /home/burgarkartan/project/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#1c01ce>RUN pip install -r requirements.txt -U --user &amp;&amp; echo &#34;export PATH=$(python -c &#39;import site; print(site.USER_BASE + &#34;/bin&#34;)&#39;):$PATH&#34; &gt;&gt; ~/.bashrc</span>
</span></span></code></pre></div><p>As can be seen in the first RUN step, I created a new user with the uid of 998. This ID corresponds to the ID of the same user I created in my host, using useradd -r -M -s /usr/sbin/nologin burgarkartan. Run id <username>on your host to find the id. This is necessary to avoid any permission issues on the mapped files between the host and container.
The final folder structure on the host looks like:</p><pre tabindex=0><code>root@Gambit:/var/www# ls -lh burgarkartan.se/
total 8.0K
-rw------- 1 root         root          561 Aug 13 23:15 docker-compose.yml
drwxr-xr-x 5 burgarkartan burgarkartan 4096 Aug 13 14:06 static
</code></pre><p>The static directory contains static files like CSS and JavaScript files which will be served by nginx.
A crucial step in my docker setup is the entrypoint.sh script. It&rsquo;s defined as the entrypoint and is used for running the Django application in either production or development.</p><h2 id=getting-ready-for-action>Getting ready for Action</h2><p>Once you are satisfied with your production configuration and your Dockerfile, it&rsquo;s time to set up Github actions. To do that, I suggest following the article below, it contains all you need.Publishing and installing a package with GitHub Actions - GitHub Docs
You can configure a workflow in GitHub Actions to automatically publish or install a package from GitHub Packages.
<a href=https://docs.github.com/en/packages/managing-github-packages-using-github-actions-workflows/publishing-and-installing-a-package-with-github-actions#publishing-a-package-using-an-action>https://docs.github.com/en/packages/managing-github-packages-using-github-actions-workflows/publishing-and-installing-a-package-with-github-actions#publishing-a-package-using-an-action</a></p><p>You should have something that looks like this. The next step is create a release.</p><h3 id=release-the-kraken>Release the kraken</h3><p>Creating a release in Github is super easy, head over to the release tab and click Draft a new release.</p><img src=Screenshot-2023-08-30-at-21.56.40.png width=100%><p>Now you need to enter a new tag for this release. In the image below, you can see that my previous tag was v0.1.7, but now I want to create a new release so therefore I need to enter a new tag.</p><img src=Screenshot-2023-08-30-at-21.57.11.png><p>Once you are done, hit Publish release. Now, Github should trigger a docker build and start building your latest release for you. Head over to the actions page, you should see your latest release being built. An older version of my Django app being built.</p><img src=Screenshot-2023-08-30-at-22.02.15.png><h3 id=running-in-production>Running in production</h3><p>Once the image has been built, you can start using it in your environment. Below you will find my production ready docker-compose.yml, as you can see, the image points to ghcr.io/dubs3c/burgarkartan:v0.1.7 which was the version built in the previous screenshots.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#000>version</span>: <span style=color:#c41a16>&#39;3&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#000>services</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>  <span style=color:#000>burgarkartan</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#000>container_name</span>: <span style=color:#1c01ce>burgarkartan-prod</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#000>image</span>: <span style=color:#1c01ce>ghcr.io/dubs3c/burgarkartan:v0.1.7</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#000>command</span>: <span style=color:#1c01ce>bash entrypoint.sh prod</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#000>ports</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>      - <span style=color:#c41a16>&#34;127.0.0.1:8001:8000&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#000>volumes</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>      - <span style=color:#c41a16>&#34;./static:/home/burgarkartan/project/assets&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#000>env_file</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>      - <span style=color:#1c01ce>/root/burgarkartan.se.env</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>      - <span style=color:#1c01ce>/root/burgarkartan.se.db.env</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#000>depends_on</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>      - <span style=color:#1c01ce>postgres</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>  <span style=color:#000>postgres</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#000>image</span>: <span style=color:#1c01ce>postgres:15.4</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#000>env_file</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>      - <span style=color:#1c01ce>/root/burgarkartan.se.db.env</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#000>volumes</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>      - <span style=color:#1c01ce>/var/lib/burgarkartan/postgresql/data:/var/lib/postgresql/data</span>
</span></span></code></pre></div><p>Now it&rsquo;s simply a matter of running docker-compose up -d, and your latest image built by Github should be downloaded.
The end</p><p>Hopefully this was useful and that you now know have an idea on how could deploy Django applications with Github. If you have any questions, don&rsquo;t hesitate to reach out on Twitter.</p></div></div></div></article></div><div class=row><footer></footer></div></div><script src=/js/bootstrap.min.js async></script><script src=/js/main.js defer async></script></body></html>