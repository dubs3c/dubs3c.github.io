{"metadata":{"date":"Jun 12, 2016","title":"Monitoring your server with Monit","template":"post","slug":"monitoring-your-server-with-monit","categories":["System Administration"],"tags":["System Administration"]},"content":"<p>I run a couple of services on my server, some of them are web, teamspeak, irc and an openvpn server. I need to be notified if any of these services becomes unresponsive for some reason. This is where <a href=\"https://mmonit.com/monit/\">Monit</a> comes in.</p>\n<h2>What is Monit?</h2>\n<blockquote>\n<p>Monit is a small Open Source utility for managing and monitoring Unix systems. Monit conducts automatic maintenance and repair and can execute meaningful causal actions in error situations.</p>\n</blockquote>\n<p>I use monit to monitor all my services and alert me via email if any service does not respond. For example, this is my monit configuration file for monitoring my web server:</p>\n<pre><code class=\"hljs language-ebnf\"><span class=\"hljs-attribute\">check host dubell</span>.io with address dubell.io every 20 cycles \n<span class=\"hljs-attribute\">  if failed\n        host dubell</span>.io\n<span class=\"hljs-attribute\">        port</span> 443\n<span class=\"hljs-attribute\">        protocol https\n        status</span> = 200\n  then alert\n</code></pre>\n<p>This config file informs monit to check my website every 10 minutes and raise an alert if the HTTP status is not 200. An alert message looks like this:</p>\n<pre><code class=\"hljs language-ebnf\"><span class=\"hljs-attribute\">Connection failed Service dubell</span>.io\n\n<span class=\"hljs-attribute\">        Date</span>:        Sun, 12 Jun 2016 21:03:16\n<span class=\"hljs-attribute\">        Action</span>:      alert\n<span class=\"hljs-attribute\">        Host</span>:        dubellio\n<span class=\"hljs-attribute\">        Description</span>: failed protocol test [HTTP] at [dubell.io]:443 [TCPSSL/IP] -- HTTP error: Server returned status 502\n\n<span class=\"hljs-attribute\">Your faithful employee</span>,\n<span class=\"hljs-attribute\">Monit</span>\n</code></pre>\n<p>Monit will also inform you when a service starts responding again:</p>\n<pre><code class=\"hljs language-ebnf\"><span class=\"hljs-attribute\">Connection succeeded Service dubell</span>.io\n\n<span class=\"hljs-attribute\">        Date</span>:        Sun, 12 Jun 2016 21:04:19\n<span class=\"hljs-attribute\">        Action</span>:      alert\n<span class=\"hljs-attribute\">        Host</span>:        dubellio\n<span class=\"hljs-attribute\">        Description</span>: connection succeeded to [dubell.io]:443 [TCPSSL/IP]\n\n<span class=\"hljs-attribute\">Your faithful employee</span>,\n<span class=\"hljs-attribute\">Monit</span>\n</code></pre>\n<p>If you would like to monitor your own teamspeak server, you could do something like this:</p>\n<pre><code class=\"hljs language-sql_more\"><span class=\"hljs-keyword\">check</span> host youteamspeak.com <span class=\"hljs-keyword\">with</span> address <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>\n   <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">failed</span>\n     port <span class=\"hljs-number\">9987</span>\n     <span class=\"hljs-keyword\">type</span> udp\n   <span class=\"hljs-keyword\">then</span> alert\n</code></pre>\n<p>If the teamspeak server does not respond using UDP packets on port 9987, raise an alert.</p>\n<h2>Automatic Repair</h2>\n<p>What's great about Monit is that you can also specify what to do in the event of a crashed service. You can program monit to restart services or execute a specific program.</p>\n<p>In the following example we use udp for connection testing to check if the name-server is running, if false then restart the service:</p>\n<pre><code class=\"hljs language-smali\"><span class=\"hljs-built_in\"> check </span>process named with pidfile /var/run/named.pid\n       start program = <span class=\"hljs-string\">\"/etc/init.d/named start\"</span>\n       stop program  = <span class=\"hljs-string\">\"/etc/init.d/named stop\"</span>\n      <span class=\"hljs-built_in\"> if </span>failed port 53 use type udp protocol dns then restart\n</code></pre>\n<h2>Conclusion</h2>\n<p>Monitoring your services are a must for any serious applications or networks. Monit is a great and easy tool for making sure that servers and services are up and running.</p>\n<p>Check out the <a href=\"https://mmonit.com/monit/documentation/monit.html\">monit documentation</a> to find out what more you can do with Monit!</p>"}