<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/vollkorn/Vollkorn-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | My thoughts on Secure Code Review"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | My thoughts on Secure Code Review"><meta name=twitter:title content="dubell.io | My thoughts on Secure Code Review"><meta itemprop=name content="dubell.io | My thoughts on Secure Code Review"><meta name=application-name content="dubell.io | My thoughts on Secure Code Review"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content=2022-07-01T09:51:17+0200><meta property="article:published_time" content=2022-07-01T09:51:17+0200><base href=https://dubell.io/my-thoughts-on-secure-code-review/><link rel=canonical href=https://dubell.io/my-thoughts-on-secure-code-review/ itemprop=url><meta name=url content="https://dubell.io/my-thoughts-on-secure-code-review/"><meta name=twitter:url content="https://dubell.io/my-thoughts-on-secure-code-review/"><meta property="og:url" content="https://dubell.io/my-thoughts-on-secure-code-review/"><meta property="og:article:author" content="Dubs3c"><meta property="article:author" content="Dubs3c"><meta name=author content="Dubs3c"><meta name=description content="Thoughts on performing secure code review"><meta itemprop=description content="Thoughts on performing secure code review"><meta property="og:description" content="Thoughts on performing secure code review"><meta name=twitter:description content="Thoughts on performing secure code review"><meta itemprop=image content="https://dubell.io/img/logo2.png"><meta property="og:image" content="https://dubell.io/img/logo2.png"><meta name=twitter:image content="https://dubell.io/img/logo2.png"><meta name=twitter:image:src content="https://dubell.io/img/logo2.png"><meta property="og:updated_time" content=2022-07-01T09:51:17+0200><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.io/sitemap.xml><title>dubell.io | My thoughts on Secure Code Review</title></head><body><div class=container><div class=row><div class=col><h1 class=logo-title><a href=/>dubell.io</a></h1></div></div><div class=row><div class=col><nav id=menu><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></nav></div></div><div class=row><article><h1>My thoughts on Secure Code Review</h1><p><small><a href=/categories/appsec>Appsec</a> / July 1, 2022 ‚Ä¢ 7 min read</small><br><small><strong>Tags:</strong> <a href=/tags/code-review class=tag>Code Review</a></small></p><div id=article_content><div class=row><div class=col-lg-6><p>In this article I would like to share my thoughts, methodologies and techniques on how I perform <em>secure</em> code review. By <em>secure</em> I mean code review with the purpose of finding unknown vulnerabilities. My focus is generally on web applications, but the ideas mentioned below apply to other types of software as well.</p><h3 id=1-understanding->1. Understanding üë®‚Äçüè´</h3><p>Begin by understanding the application. Browse through the code and the application&rsquo;s functionality until you have a clear intuition for what the application is capable of. By browsing the code, you get a feel for the quality and style of the code. By quality I mean: is there a lot of duplicate code, how are variables and functions named? Is there a lot of over-engineering going on? This may be an indication of unnecessary complexity that might contain vulnerabilities.</p><p>There are a few tools that can aid you in understanding the quality and complexity of an application, such as <a href=https://en.wikipedia.org/wiki/ABC_Software_Metric>ABC Metrics</a> and <a href=https://en.wikipedia.org/wiki/Cyclomatic_complexity>Cyclomatic complexity</a>. I generally do not use these types of methods when doing code review.</p><p>Using static analysis tools such as <a href=https://semgrep.dev/>Semgrep</a> and/or <a href=https://codeql.github.com/>CodeQL</a> at the beginning of the review can help you highlight possible security issues which you later can analyze. It can also give you a general feeling for what types of issues exist within the codebase.</p><p>Understand where all the user inputs are and how they are being consumed.</p><h3 id=2-brainstorm->2. Brainstorm üß†</h3><p>Identify possible weak points, where can issues arise? For instance, if oauth is being used, how closely are they following the RFC? Do they verify state/nonce/signatures?</p><p>Is there login functionality, if so, how are sessions handled? If you know the application is using a well-established framework that handles sessions, you can mark that as &ldquo;unlikely to be vulnerable&rdquo;. But you should still verify that the application handles sessions correctly. This is easiest done by testing it in practice. You can follow the code flow as you test either with a debugger or doing it manually. I usually &ldquo;trace&rdquo; the function flow myself, while I am testing. Having a debugger is of course preferable.</p><p>Identify the technology stack. Are there any known vulnerabilities? Is OWASP-Dependency check used? If so, you got free information! Otherwise, you can build or find a tool that automatically checks for known vulnerabilities in dependencies.</p><p>Write down all your thoughts about what you have seen so far, and what you think could be exploited. My notes usually look something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span># Ze Notes
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a90d91>- [ ]</span> Possible to convert .docx to pdf =&gt; XXE, LFI, RFI ?? Extract data from AWS metadata url?
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#a90d91>- [ ]</span> User roles =&gt; check for broken access control
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#a90d91>- [X]</span> WYSIWYG editor, inject xss? Works as expected
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#a90d91>-</span> [-] eval() is used in src/path/file.py:45 =&gt; looks like user input can reach this, verify. =&gt; No dice
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#a90d91>- [X]</span> Outdated dependencies, check for known vulns =&gt; found CVE-123-456
</span></span></code></pre></div><p><code>X</code> indicates I was successful, while <code>-</code> means unsuccessful.</p><h3 id=3-hack-away->3. Hack away üë©‚Äçüíª</h3><p>Once you have brainstormed potential risks and possible issues, it&rsquo;s time to work through them. Once each item has been verified, cross it off the list and move to the next one. If you found something funky but couldn&rsquo;t really exploit it, write it down next to the item. Specify what you did and why you think there may be something funky going on, something that could lead to security vulnerabilities. This will help you when you come back to this item after a few hours or days.</p><p>Of course, you may identify other leads during testing that you would like to pursue. This is totally fine and is encouraged. The list produced during the brainstorming phase should not be considered final. New ideas will form as you get deeper into testing.</p><h2 id=how-to-measure-success->How to measure success ü§©</h2><p>When reviewing open source applications or even customer applications, there will be times where you will find nothing. Sometimes, this is the case, there is nothing to be found. Therefore, it is important <strong>not</strong> to measure success by the amount of vulnerabilities found. Instead, measure success by your level of understanding of the codebase. If you understand the codebase, you can be comfortable in saying that there are no vulnerabilities.</p><p>Speed reading code is not a good indicator of progress. Code review is about quality, not quantity. It is not uncommon for reviewers to spend many hours reading the same code repeatedly. Good progress with lead to greater insight of the code you are reading, as well as improving how easy it to approach a new codebase.</p><p>It&rsquo;s also worth mentioning that testing an application and reading code is quite exhausting. Therefore, it is important to take breaks, get some exercise and reload your mind every now and then. Looking at code while being tired as fuck is not going to yield great results.</p><h2 id=choose-your-style->Choose your style üï∫</h2><p>You might have noticed that I work with checklists, and I follow a specific process. This might sound boring and restrictive. But the truth is that when you are testing an application for security vulnerabilities, you are essentially following a list. Either the list resides in your head, perfectly reserved, or you have an excel document. I personally use OWASP ASVS as my checklist in case I forget to test something. But I also rely on personal experience. Keep in mind that the ASVS is not a complete list. I simply use it as a reference for testing certain areas, such as &ldquo;Authentication&rdquo;. For example, let&rsquo;s say that I for some reason forgot to test authentication issues. I would look in ASVS&rsquo;s table of contents and immediately recognize that I forgot to test &ldquo;Authentication&rdquo;. Now, how I go about testing that is a different story. The individual testing process for a specific area, is usually based on previous experience and knowledge. Unless it is something complex, I rarely look up how to test a specific vulnerability class.</p><p>Oauth, OpenID Connect and SAML is something I must read up on before a test/review because there are so many things going on and different flows you need to consider. Some things I just can&rsquo;t keep in my head ü§∑‚Äç‚ôÇÔ∏è</p><p>There are many ways you could go about testing an application with access to source code. You can for example choose a specific functionality and its corresponding source code. Maybe you feel confident you can simply read the code for a given function and see if there are any vulnerabilities, without spending too much time performing practical tests.</p><p>I personally use checklists and practical testing, assisted by source code. But how I choose to go about testing a specific software, changes from project to project. I might start with learning the application, then spend a day looking at code. Or the opposite.</p><p><strong>The process is always changing, but the core methodology is always present.</strong></p><h2 id=always-improve->Always improve üë©‚Äçüéì</h2><p>I mentioned before that it is good to always keep improving, sharpening the blade, developing the craft. By this I mean, reflect on your process, methodology and imagine other ways of doing it. Is there a part or technology in your process that you can update or improve? If you have an idea, sketch it out, try to develop a prototype and see if it works. It can literally be anything <strong>you</strong> find valuable.</p><p>For example, I created a program in Python that presents a few technologies that I mostly encounter. I select the ones that are relevant for the current project, in return I get all my notes specific to those technologies. Works surprisingly well. It&rsquo;s faster than looking through all my files manually. I have some other ideas that I am going to develop to improve collaborative secure code review.</p><p>Point is, live on the edge and keep pushing boundaries. Develop new techniques and expand your mind.</p><h2 id=final-thoughts->Final thoughts üöÄ</h2><p>I hope you find this interesting and perhaps even adopted some of the methods detailed here.</p><p>Something I haven&rsquo;t mentioned yet is, surround yourself with hackers that are better than you. Since joining my current employer, my motivation and interest in hacking has only amplified. Before I was alone in my quest for deeper knowledge, now I don&rsquo;t have to do it alone.</p><p>Some general tips:</p><ul><li>Ask questions, never assume, always verify</li><li>Documentation/RFC is your friend, probably your best friend</li><li>Code review takes time and consumes a lot of energy, make sure to take breaks and focus only on your current objective</li><li>Work in batches/chunks</li><li>Use SAST tools to uncover possible security issues to explore</li><li>Have a journal where you can write about your testing and any results you might have. You can also include issues you encountered during the review, such as the dev team destroying your environment which slowed down your testing. Or maybe you needed access to the source of a specific component but never got it (or got it very late).</li><li>Have a checklist containing possible issues that you identified during your brainstorm session. Work through these.</li><li>OWASP ASVS is your friend as well. It is impossible to remember every attack vector out there. Try to create a personal database of general issues as well as specific programming or framework issues. It should be searchable</li><li>If possible, save any important files such as <code>swagger.yml</code> or store all endpoints being tested</li><li>Risk assessment and context! Some vulnerabilities are not critical because of the context they are in.</li><li>Sources and sinks!</li></ul></div></div></div></article></div><div class=row><footer></footer></div></div><script src=/js/bootstrap.min.js async></script><script src=/js/main.js defer async></script></body></html>