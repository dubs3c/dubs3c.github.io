<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/vollkorn/Vollkorn-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | Security Recommendations For Implementing BankID"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | Security Recommendations For Implementing BankID"><meta name=twitter:title content="dubell.io | Security Recommendations For Implementing BankID"><meta itemprop=name content="dubell.io | Security Recommendations For Implementing BankID"><meta name=application-name content="dubell.io | Security Recommendations For Implementing BankID"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content=2019-05-19T20:32:37Z><meta property="article:published_time" content=2019-05-19T20:32:37Z><base href=https://dubell.io/security-recommendations-for-implementing-bankid/><link rel=canonical href=https://dubell.io/security-recommendations-for-implementing-bankid/ itemprop=url><meta name=url content="https://dubell.io/security-recommendations-for-implementing-bankid/"><meta name=twitter:url content="https://dubell.io/security-recommendations-for-implementing-bankid/"><meta property="og:url" content="https://dubell.io/security-recommendations-for-implementing-bankid/"><meta property="og:article:author" content="Dubs3c"><meta property="article:author" content="Dubs3c"><meta name=author content="Dubs3c"><meta name=description content="Security aspects to think about when implementing BankID"><meta itemprop=description content="Security aspects to think about when implementing BankID"><meta property="og:description" content="Security aspects to think about when implementing BankID"><meta name=twitter:description content="Security aspects to think about when implementing BankID"><meta itemprop=image content="https://dubell.io/img/logo2.png"><meta property="og:image" content="https://dubell.io/img/logo2.png"><meta name=twitter:image content="https://dubell.io/img/logo2.png"><meta name=twitter:image:src content="https://dubell.io/img/logo2.png"><meta property="og:updated_time" content=2019-05-19T20:32:37Z><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.io/sitemap.xml><title>dubell.io | Security Recommendations For Implementing BankID</title></head><body><div class=container><div class=row><div class=col><h1 class=logo-title><a href=/>dubell.io</a></h1></div></div><div class=row><div class=col-lg-6><nav id=menu><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/categories/advisories/>/opt/advisories</a></li><li><a href="https://github.com/dubs3c?tab=repositories&q=&type=source&language=&sort=">/opt/code</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></nav></div></div><div class=row><article><h1>Security Recommendations For Implementing BankID</h1><p><small><a href=/categories/research>Research</a> / May 19, 2019 • 7 min read</small><br><small><strong>Tags:</strong> <a href=/tags/bankid class=tag>bankid</a></small></p><div id=article_content><div class=row><div class=col-lg-6><p><em>This article was originally published at <a href=https://kits.se/blogg-2019-05-13/bankid-anyone>https://kits.se/blogg-2019-05-13/bankid-anyone</a></em></p><hr><p>BankID is the leading identification solution in Sweden that allows companies and government agencies to authenticate individuals over the Internet. BankID offers an API which makes integration easy for companies.</p><p>In this article I will describe BankID API features which developers should use to limit the effectiveness of today’s phishing attacks against BankID. I will also cover how QR codes can be used as a method for authentication/signing with mobile BankID and how it can improve security.</p><p>After reading this article, you will have learned different phishing techniques that exists and what you can do to limit their effectiveness.</p><h2 id=ordering-shoes>Ordering shoes</h2><p>Depending on which platform you initiate BankID on, the flow will be different.</p><p>Let’s assume we want to order a pair of shoes from supershoes.se on our computer. We pick our shoes, proceed to checkout, enter our address information and select mobile BankID as our signing method. We enter our personal identity number (PIN) and open the BankID app on our phone and sign.</p><p>What happened was that supershoes.se sent a signing order with our PIN to BankID using their REST API, informing that the accompanying PIN should sign this request. In this scenario, we expect the user to consume their signing order on a mobile device. I will later explain why this distinction is important. After we send this request to BankID, a special token called autoStartToken is created which is tied to our session. This token is returned to the user, depending on which BankID method is used.</p><p>The BankID API offers a requirement parameter which allows you to configure how orders should be created and verified. To configure an order to be limited to mobile BankID, set certificatePolicies in the requirement field:</p><pre tabindex=0><code>&#34;requirement&#34;: {    &#34;certificatePolicies&#34;: [&#34;1.2.752.78.1.5&#34;]}
</code></pre><p>This restricts an order to only be consumed on mobile devices. The same can be done for other platforms. If it is not evident why it is beneficial to control how an order should be consumed, the following example will show why.</p><h2 id=the-autostarttoken>The autoStartToken</h2><p>Let’s say supershoes.se implemented a member’s area page protected by BankID login, with the option to use BankID on file to authenticate. No personal identity number is technically required for this option, if you have multiple identities on your computer/phone, you will be prompted to select the appropriate identity.</p><p>Alright, we are sitting at our computer, we browse to the member’s area at supershoes.se and login by authenticating with BankID on file. What happens at this stage is that a special URL is returned to our browser which opens the BankID application automatically. The URL looks like this:</p><pre tabindex=0><code>bankid://?autostarttoken=463e5661-33a9-4738-ad1e-6c5ef1d732ce&amp;redirect=null
</code></pre><p>The local BankID application opens automatically because it has associated itself with the protocol <code>bankid://</code>. The interesting part is the <code>autoStartToken</code> parameter which contains the token value. This token is associated with your current session.</p><p>After your local BankID opens, you enter your credentials and successfully complete the identification (or signing). Now, let’s assume the developers at supershoes.se did not specify which platform the token should be limited to. This is means that even though you requested to identify/sign with BankID on file, the token you received can be consumed by mobile BankID on a different device. An attacker could generate a token meant for BankID on file and trick someone to authenticate themselves with the token on their mobile device.</p><p>The only thing an attacker needs to do is to send the following:</p><pre tabindex=0><code>bankid://?autostarttoken=463e5661-33a9-4738-ad1e-6c5ef1d732ce&amp;redirect=null
</code></pre><p>Which can of course be semi-disguised as an HTML link, like so:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>&lt;<span style=color:#000>a</span> <span style=color:#836c28>href</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;bankid://?autostarttoken=463e5661-33a9-4738-ad1e-6c5ef1d732ce&amp;redirect=null&#34;</span>&gt;Click me!&lt;/<span style=color:#000>a</span>&gt;
</span></span></code></pre></div><p>Once the unknowing user clicks the link and identify using mobile BankID on their smartphone, the attacker will be successfully logged in as the user. Why this seemingly tiny detail matters is because most users today use mobile BankID which makes this scenario easy for an attacker to perform. Had the token been limited to only be consumed using BankID on file, then this scenario had not been possible. The only thing an attacker could do is to trick someone to identify with the token using specifically BankID on file, which is harder for an attacker to convince someone to do, since most people use mobile BankID.</p><h2 id=autostarttokenrequired>AutostarttokenRequired</h2><p>In the first example we ordered shoes from supershoes.se from our computer, entered our personal identity number and chose to sign with mobile BankID. If you have multiple mobile devices with your BankID identity installed, you could open any of those devices to sign the request, which is the purpose of mobile BankID.</p><p>Let’s explore another common scenario – supershoes.se has created their own app which you have downloaded from the Appstore to your smartphone. In order to use the app, you must enter your PIN and login in using mobile BankID. Since you are <em>on your smartphone</em> and trying to login with <em>your smartphone</em>, you would expect <em>only your smartphone</em> to be able to authenticate. However, as previously mentioned if you have multiple devices with your BankID identity installed, any of them could open the BankID app the sign the request.</p><p>This becomes problematic because an attacker could enter your PIN and trick you into signing. This is how most BankID scams are performed today.</p><p>But as you may suspect, there is a way to control if all your devices should be able to sign a BankID request or if it should be limited to the device that initiated the request. This is done by specifying the <code>autoStartTokenRequired</code> field in the API request when creating an authentication/signing order request.</p><pre tabindex=0><code>&#34;requirement&#34;: {&#34;autoStartTokenRequired&#34;: true}
</code></pre><p>The option <code>autoStartTokenRequired</code> specifies that no other device will be able to sign the request. Only the device that initiated the request (<em>your smartphone in this case</em>) will get the <code>autoStartToken</code> and thereby be able to sign with BankID. This means we can make it harder for those who enter other people’s personal identity number and tricks people into signing with their mobile BankID. By specifying <code>autoStartTokenRequired</code>, only the attacker will get the <code>autoStartToken</code>. The attacker must then somehow transfer the token to the victim.</p><p>The problem is that we can’t use <code>autoStartTokenRequired</code> when ordering on our computer and signing with mobile BankID, because our mobile phone somehow needs to consume the autoStartToken. This is where QR codes comes into play.</p><p><img src=./bankid-qr-code.png alt="BankID QR Code"></p><p>The only thing developers need to do is to convert the returned URL after sending an authentication/signing order request to BankID, to a QR code and instruct the user to scan it with their mobile BankID, that’s it!</p><p>We previously mentioned the autoStartTokenRequired option and its purpose to only allow the device with the autoStartToken to authenticate/sign an order request. This works great if you are using BankID on file on your computer/smartphone or mobile BankID on the same device. However, it will not work if you are using mobile BankID on different devices, since you often initiate the request on your computer and open the mobile BankID app on your phone. The token cannot be created with <code>autoStartTokenRequired = True</code> in this scenario. This is where QR codes shines.</p><p>The QR code is just a visual representation of</p><pre tabindex=0><code>bankid://?autostarttoken=463e5661-33a9-4738-ad1e-6c5ef1d732ce&amp;redirect=null
</code></pre><p>Which now means that the user can easily consume the <code>autoStartToken</code> and sign the request.</p><p>Which is the ingredient you need to authenticate/sign with BankID. Therefore, when offering to sign with mobile BankID on a different device, <code>autoStartTokenRequired</code> can be set to <strong>True</strong> if QR codes are used.</p><h2 id=conclusion>Conclusion</h2><p>We have identified three possible flows using BankID</p><ul><li>BankID on file</li><li>Mobile BankID – different device</li><li>Mobile BankID – same device</li></ul><p>To make current phishing attacks against BankID <em>harder</em> to perform, we can do the following:</p><ul><li><p>Set <code>certificatePolicies</code> to define which platform an authentication/signing order request should be limited to.</p></li><li><p>To prevent our mobile BankID app to automatically activate when there is an existing authentication/signing request order present, we can set `autoStartTokenRequired = True´. Good for BankID on file and mobile BankID on same device.</p></li><li><p>When using mobile BankID on different devices – set <code>autoStartTokenRequired = True</code> and enable QR codes. The user must scan the QR code presented on the device that initiated the order request.</p></li><li><p>The user’s personal identity number should always be present for each order request. This limits the effectiveness of simply generating a token and sending it to random people, hoping that someone will sign using the token.</p></li></ul><p>None of these features prevents phishing attacks against BankID. They only make today’s attacks harder to perform and requires additional technical skill from the attacker than just being able to call victims. If the attacker can trick a victim into clicking a link containing the autoStartToken, it will be possible to phish BankID users.</p><p>However, the point is to make the process more difficult for the attacker, which can be achieved by following the steps above.</p><p>BankID API documentation can be found here: <a href=https://www.bankid.com/bankid-i-dina-tjanster/rp-info>https://www.bankid.com/bankid-i-dina-tjanster/rp-info</a>.</p><p><strong>Bonus question:</strong> Can you find the open redirection in the token URL? :)</p></div></div></div></article></div><div class=row><footer></footer></div></div><script src=/js/bootstrap.min.js async></script><script src=/js/main.js defer async></script></body></html>