<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/FiraCode-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | My thoughts on Secure Code Review"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | My thoughts on Secure Code Review"><meta name=twitter:title content="dubell.io | My thoughts on Secure Code Review"><meta itemprop=name content="dubell.io | My thoughts on Secure Code Review"><meta name=application-name content="dubell.io | My thoughts on Secure Code Review"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content="2022-07-01T09:51:17+0200"><meta property="article:published_time" content="2022-07-01T09:51:17+0200"><base href=https://dubell.io/www/2022/07/my-thoughts-on-secure-code-review/><link rel=canonical href=https://dubell.io/www/2022/07/my-thoughts-on-secure-code-review/ itemprop=url><meta name=url content="https://dubell.io/www/2022/07/my-thoughts-on-secure-code-review/"><meta name=twitter:url content="https://dubell.io/www/2022/07/my-thoughts-on-secure-code-review/"><meta property="og:url" content="https://dubell.io/www/2022/07/my-thoughts-on-secure-code-review/"><meta property="og:article:author" content="Dubs3c"><meta property="article:author" content="Dubs3c"><meta name=author content="Dubs3c"><meta name=description content="Thoughts on performing secure code review"><meta itemprop=description content="Thoughts on performing secure code review"><meta property="og:description" content="Thoughts on performing secure code review"><meta name=twitter:description content="Thoughts on performing secure code review"><meta itemprop=image content="/"><meta property="og:image" content="https://dubell.io"><meta name=twitter:image content="https://dubell.io"><meta name=twitter:image:src content="https://dubell.io"><meta property="og:updated_time" content="2022-07-01T09:51:17+0200"><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.iositemap.xml><title>dubell.io | My thoughts on Secure Code Review</title></head><body><div id=particles-js></div><main><div class=row><div class=col><header style=text-align:center><a href=/ class=noleet><img href=/ class=banner-image src=/img/logo2.png alt=logo></a></header></div></div><div class=row><div class=col style=text-align:center><nav><fieldset><legend>n4vig4ti0n</legend><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></fieldset></nav></div></div><div class=content><article><h1>My thoughts on Secure Code Review</h1><br><p class=small style=color:#999><a href=/categories/appsec>Appsec</a> / July 1, 2022 ‚Ä¢ 8 min read</p><p class=small><strong>Tags:</strong> <a href=/tags/code-review class=tag>Code Review</a></p><br><p>This article is going to cover my journey in cyber security, thoughts on secure code review and how to improve your own skills.</p><p>I have now worked for four years professionally in the cyber security field as consultant, mostly doing white-box assessments with access to source code. Since I have a developer background, I always approach a project with source code in mind, because to me, source is absolute truth. And from a customer perspective, it&rsquo;s way more worth the money for me to be able to view the source in order to find deeper issues. I need to be able to read the code to comment on the application&rsquo;s overall security posture.</p><p>During these years I have improved my skills in many ways, both in methodology, techniques and overall knowledge about systems and programming. You may ask &ldquo;how&rdquo;, well, through sheer motivation. Bug bounty and programming was a big part of my journey. Always reading the latest reports, saving everything of value then re-reading it later. Anything I could practice on I used, e.g., CTF and HackTheBox.</p><p>I regret that I didn&rsquo;t have some sort of mentor, but nothing is impossible if you have the right attitude.</p><p>It&rsquo;s important to be aware of your knowledge gaps and always improve where you can. Nasty bugs can exist in all kinds of places. If you are only looking in specific areas, you&rsquo;ll miss all the bugs that exist outside of your comfort zone.</p><p>In this article I would like to share my thoughts, methodologies and techniques on how I perform <em>secure</em> code review. By <em>secure</em> I mean code review with the purpose of finding unknown vulnerabilities. My focus is generally on web applications, but the ideas mentioned below apply to other types of software as well.</p><p>Before we start, I want to also clarify that in order to be <strong>successful</strong> in <strong>secure code review</strong>, you need to be able to understand code, which you can only achieve by writing code yourself.</p><h3 id=1-understanding->1. Understanding üë®‚Äçüè´</h3><p>Begin by understanding the application, browse through the code and the application&rsquo;s functionality until you have a clear intuition for what the application is capable of. By browsing the code, you get a feel for the quality and style of the code. By quality I mean: is there a lot of duplicate code, how are variables and functions named? Is there a lot of over-engineering going on? This may be an indication of unnecessary complexity that might contain vulnerabilities.</p><p>There are a few tools that can aid you in understanding the quality and complexity of an application, such as <a href=https://en.wikipedia.org/wiki/ABC_Software_Metric>ABC Metrics</a> and <a href=https://en.wikipedia.org/wiki/Cyclomatic_complexity>Cyclomatic complexity</a>. I don&rsquo;t personally use these types of methods when doing code review.</p><p>Using static analysis tools such as <a href=https://semgrep.dev/>Semgrep</a> and/or <a href=https://codeql.github.com/>CodeQL</a> in the beginning of the review can help you highlight possible security issues which you later can analyze. It can also give you a general feeling for what types of issues exist within the codebase.</p><p>Understand where all the user inputs are and how they are being consumed.</p><h3 id=2-brainstorm->2. Brainstorm üß†</h3><p>Identify possible weak points, where can issues arise? For instance, if oauth is being used, how closely are they following the RFC? Do they verify state/nonce/signatures?</p><p>Is there login functionality, if so, how are sessions handled? If you know the application is using a well-established framework that handles sessions, you can mark that as &ldquo;unlikely to be vulnerable&rdquo;. But you should still verify that the application is handling sessions correctly. This is easiest done by testing it in practice. You can follow the code flow as you test either with a debugger or doing it manually. I usually &ldquo;trace&rdquo; the function flow myself, while I am testing. Having a debugger is of course preferable.</p><p>Identify technology stack. Are there any known vulnerabilities? Is OWASP-Dependency check used? If so, you got free information! Otherwise, you can build or find a tool that automatically checks for known vulnerabilities in dependencies.</p><p>Write down all your thoughts about what you have seen so far, and what you think could be possible to exploit. My notes usually look something like this:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=font-weight:700># Ze Notes
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=font-weight:700></span><span style=color:#fb660a;font-weight:700>- [ ]</span> Possible to convert .docx to pdf =&gt; XXE, LFI, RFI ?? Extract data from AWS metadata url?
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#fb660a;font-weight:700>- [ ]</span> User roles =&gt; check for broken access control
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#fb660a;font-weight:700>- [X]</span> WYSIWYG editor, inject xss? Works as expected
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#fb660a;font-weight:700>-</span> [-] eval() is used in src/path/file.py:45 =&gt; looks like user input can reach this, verify. =&gt; No dice
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#fb660a;font-weight:700>- [X]</span> Outdated dependencies, check for known vulns =&gt; found CVE-123-456
</span></span></code></pre></div><p><code>X</code> indicates I was successful, while <code>-</code> means unsuccessful.</p><h3 id=3-hack-away->3. Hack away üë©‚Äçüíª</h3><p>Once you have brainstormed potential risks and possible issues, it&rsquo;s time to work through them. Once each item has been verified, cross it off the list and move to the next one. If you found something funky but couldn&rsquo;t really exploit it, write this down next to the item. Specify what you did and why you think there may be something funky going on, something that could lead to security vulnerabilities. This will help you when you come back to this item after a few hours or days.</p><p>Of course, you may identify other leads during testing which you would like to pursue. This is totally fine and is encouraged. The list produced during the brainstorming phase should not be considered as final. New ideas will form as you get deeper into testing.</p><h2 id=how-to-measure-success->How to measure success ü§©</h2><p>When reviewing open source applications or even customer applications, there will be times where you will find nothing. Sometimes, this is the case, there is nothing to be found. Therefore, it is important <strong>not</strong> to measure success by the amount of vulnerabilities found. Instead, measure success by your level of understanding of the codebase. If you understand the codebase, you can be comfortable in saying that there are no vulnerabilities. Progressing in code review means understanding the code, be able to identify where problems can arise. Also, how easy it is for you to approach a new codebase.</p><p>Speed reading code is not a good indicator of progress, code review is about quality, not quantity. It is not uncommon for reviewers to spend many hours reading the same code repeatedly.</p><p>It&rsquo;s also worth mentioning that testing an application and reading code is quite exhausting. Therefore, it is important to take breaks, get some exercise and reload your mind every now and then. Looking at code while being tired as fuck is not going to yield great results.</p><h2 id=choose-your-style->Choose your style üï∫</h2><p>You might have noticed that I work with checklists, and I follow a specific process. This might sound boring and restrictive. But the truth is that when you are testing an application for security vulnerabilities, you are essentially following a list. Either the list resides in your head, perfectly reserved, or you have an excel document. I personally use OWASP ASVS as my checklist in case I forget to test something. But I also rely on personal experience. Keep in mind that the ASVS is not a complete list. I simply use it as a reference for testing certain areas, such as &ldquo;Authentication&rdquo;. For example, let&rsquo;s say that I for some reason forgot to test authentication issues. I would look in ASVS&rsquo;s table of contents and immediately recognize that I forgot to test &ldquo;Authentication&rdquo;. Now, how I go about testing that is a different story. The individual testing process for a specific area, is usually based on previous experience and knowledge. Unless it is something complex, I rarely look up how to test a specific vulnerability class.</p><p>Oauth, OpenID Connect and SAML is something I must read up on before a test/review because there are so many things going on and different flows you need to consider. Some things I just can&rsquo;t keep in my head ü§∑‚Äç‚ôÇÔ∏è</p><p>There are many ways you could go about testing an application with access to source code. You can for example choose a specific functionality and its corresponding source code. Maybe you feel confident you can simply read the code for a given function and see if there are any vulnerabilities, without spending too much time performing practical tests.</p><p>I personally use checklists and practical testing, assisted by source code. But how I choose to go about testing a specific software, changes from project to project. I might start with learning the application, then spend a day looking at code. Or the opposite.</p><p><strong>The process is always changing, but the core methodology is always present.</strong></p><h2 id=always-improve->Always improve üë©‚Äçüéì</h2><p>I mentioned before that it is good to always keep improving, sharpening the blade, developing the craft. By this I mean, reflect on your process, methodology and imagine other ways of doing it. Is there a part or technology in your process that you can update or improve? If you have an idea, sketch it out, try to develop a prototype and see if it works. It can literally be anything <strong>you</strong> find valuable.</p><p>For example, I created a program in Python that presents a few technologies that I mostly encounter. I select the ones that are relevant for the current project, in return I get all my notes specific to those technologies. Works surprisingly well. It&rsquo;s faster than looking through all my files manually. I have some other ideas that I am going to develop to improve collaborative secure code review.</p><p>Point is, live on the edge and keep pushing boundaries. Develop new techniques and expand your mind.</p><h2 id=final-thoughts->Final thoughts üöÄ</h2><p>I hope you have found this interesting and perhaps even adopted some of the methods detailed here.</p><p>Something I haven&rsquo;t mentioned yet is, surround yourself with hackers that are better than you. Since joining my current employer, my motivation and interest for hacking has only amplified. Before I was alone in my quest for deeper knowledge, now I don&rsquo;t have to do it alone.</p><p>Some general tips:</p><ul><li>Ask questions, never assume, always verify</li><li>Documentation/RFC is your friend, probably your best friend</li><li>Code review takes time and consumes a lot of energy, make sure to take breaks and focus only on your current objective</li><li>Work in batches/chunks</li><li>Use SAST tools to uncover possible security issues to explore</li><li>Have a journal where you can write about your testing and any results you might have. You can also include issues you encountered during the review, such as the dev team destroying your environment which slowed down your testing. Or maybe you needed access to the source of a specific component but never got it (or got it very late).</li><li>Have a checklist containing possible issues that you identified during your brainstorm session. Work through these.</li><li>OWASP ASVS is your friend as well. It is impossible to remember every attack vector out there. Try to create a personal database of general issues as well as specific programming or framework issues. It should be searchable</li><li>If possible, save any important files such as <code>swagger.yml</code> or store all endpoints being tested</li><li>Risk assessment and context! Some vulnerabilities are not critical because of the context they are in.</li><li>Sources and sinks!</li></ul></article></div><footer></footer></main><script src=/js/particles.min.js defer></script>
<script src=/js/particles.conf.js defer></script>
<script src=/js/baffle.min.js async></script>
<script src=/js/main.js defer async></script></body></html>